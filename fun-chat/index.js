(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{y:()=>N,p:()=>T});class t{constructor(e){this.element=document.createElement(e.tag),this.createElement(e)}createElement(e){e.classNames.forEach((e=>{var t;return null===(t=this.element)||void 0===t?void 0:t.classList.add(e)})),e.text&&(this.element.textContent=e.text)}getElement(){return this.element}appendElement(e){var t;null===(t=this.element)||void 0===t||t.append(e)}removeElement(){this.element.remove()}}const s=new class extends t{constructor(){super({tag:"div",classNames:["modalBackground"]}),this.modal=new t({tag:"div",classNames:["modal"]}).getElement(),this.title=new t({tag:"h3",classNames:["modal__title"]}).getElement(),this.btnClose=new t({tag:"button",classNames:["btn","btn-action","btn-close"],text:"Ok"}).getElement(),this.prepareModal()}prepareModal(){this.btnClose.addEventListener("click",(()=>this.hideModal())),this.modal.append(this.title,this.btnClose),this.getElement().append(this.modal)}setTitle(e){this.title.textContent=e}showModal(e){this.setTitle(e),this.getElement().classList.add("show")}hideModal(){this.getElement().classList.remove("show")}addModalToDOM(){document.body.append(this.getElement())}},i=new class{saveUserToLS(e,t=""){const s={login:e.login,password:t,isLogined:e.isLogined};sessionStorage.setItem("LH_user",JSON.stringify(s))}getActiveUser(){const e=sessionStorage.getItem("LH_user");return e?JSON.parse(e):null}removeUser(){sessionStorage.removeItem("LH_user")}};var a,r,n,o;!function(e){e[e.login=0]="login",e[e.main=1]="main",e[e.about=2]="about"}(a||(a={})),function(e){e[e.login=0]="login",e[e.main=1]="main",e[e.about=2]="about"}(r||(r={})),function(e){e.login="USER_LOGIN",e.logout="USER_LOGOUT",e.usersActive="USER_ACTIVE",e.usersNonActive="USER_INACTIVE",e.msgSend="MSG_SEND",e.msgHistory="MSG_FROM_USER",e.msgRead="MSG_READ",e.error="ERROR",e.externalLogin="USER_EXTERNAL_LOGIN",e.externalLogout="USER_EXTERNAL_LOGOUT",e.msgDelete="MSG_DELETE",e.msgEdit="MSG_EDIT",e.msgDelivery="MSG_DELIVER"}(n||(n={})),function(e){e.active="active",e.nonactive="nonactive"}(o||(o={}));const l=[{path:"login",view:a.login},{path:"main",view:a.main},{path:"about",view:a.about}],d=new class{constructor(e){this.config=l,this.pathSegmentsToKeep=e,this.addListenerToWindow()}start(){const e=i.getActiveUser();if(e)return c.sendRequestForUserLogin(e.login,e.password),T.setCurrentUser(e.login,e.password),void this.main();this.goToPath(this.config[r.login])}main(){T.getActiveUser()&&(this.goToPath(this.config[r.main]),T.setActiveUser(),N.mainPage.setActiveUser(),N.clearLoginForm())}about(){this.goToPath(this.config[r.about])}goToPath(e){const t=window.location.pathname.split("/").slice(1,this.pathSegmentsToKeep+1).join("/");try{history.pushState({},"",`/${t}/${e.path}`)}catch(t){history.pushState({},"",`/${e.path}`)}N.render(e.view)}getShortPath(e){return e.split("/").at(-1)||""}goTo(e){const t=this.config.find((t=>t.path===e));t&&N.render(t.view)}goBack(){history.back()}addListenerToWindow(){window.addEventListener("popstate",(()=>{const e=this.getShortPath(window.location.pathname);this.goTo(`${e}`)}))}}(2);class g{getRequestForLogin(e,t,s){return{id:String(e),type:n.login,payload:{user:{login:t,password:s}}}}getRequestForLogout(e,t){return{id:String(e),type:n.logout,payload:{user:{login:t.login,password:t.password}}}}getRequestForOnlineUsers(e){return{id:String(e),type:n.usersActive,payload:null}}getRequestForOfflineUsers(e){return{id:String(e),type:n.usersNonActive,payload:null}}getRequestForMessageToUser(e,t,s){return{id:String(e),type:n.msgSend,payload:{message:{to:t,text:s}}}}getRequestForHistoryMessageFromUser(e,t){return{id:String(e),type:n.msgHistory,payload:{user:{login:t}}}}getRequestForStatusRead(e,t){return{id:String(e),type:n.msgRead,payload:{message:{id:t}}}}getRequestForMessageDelete(e,t){return{id:String(e),type:n.msgDelete,payload:{message:{id:t}}}}getRequestForMessageEdit(e,t,s){return{id:String(e),type:n.msgEdit,payload:{message:{id:t,text:s}}}}}const h="ws://localhost:4000",c=new class{constructor(){this.id=1,this.socket=new WebSocket(h),this.requests=[],this.message=new g,this.addListeners()}openConnection(){this.socket=new WebSocket(h),this.addListeners();const e=T.getActiveUser();e&&(T.logout(),T.setCurrentUser(e.login,e.password),this.sendRequestForUserLogin(e.login,e.password))}addListeners(){this.socket.onopen=()=>s.hideModal(),this.socket.onclose=()=>{s.showModal("No connection with server!"),this.openConnection()},this.socket.onmessage=e=>{this.readMessage(e)},this.socket.onerror=e=>{this.readError(e)}}readError(e){this.checkServerStatus()&&console.log(e)}readMessage(e){const t=JSON.parse(e.data);if(null===t.id)return void this.readMessageFromServer(t);const s=this.requests.find((e=>e.id===t.id));s&&(t.type!==n.error?(s.type===n.login&&this.readMessageLogin(t),s.type===n.usersActive&&this.readMessageAllUsers(t,o.active),s.type===n.usersNonActive&&this.readMessageAllUsers(t,o.nonactive),s.type===n.msgHistory&&this.readMessageHistory(t,s.user),s.type===n.msgSend&&this.readMessageFromUser(t),s.type===n.msgDelete&&this.readMessageDeleteMessage(t),s.type===n.msgEdit&&this.readMessageEditMessage(t)):this.readErrorMessage(t))}readMessageEditMessage(e){T.editMessageInChat(e)}readMessageDeleteMessage(e){T.deleteMessage(e)}readMessageFromUser(e){T.showNewMessage(e)}readMessageHistory(e,t){T.showUnreadMessages(e,t),T.showDialogHistory(e,t)}readMessageFromServer(e){e.type!==n.externalLogin&&e.type!==n.externalLogout?e.type!==n.msgSend?e.type!==n.msgDelete?e.type!==n.msgEdit?e.type!==n.msgDelivery?e.type!==n.msgRead||this.readMessageReadMessageFromServer(e):this.readMessageDeliveryMessageFromServer(e):this.readMessageEditMessageFromServer(e):this.readMessageDeleteMessageFromServer(e):this.readMessageNewMessageFromServer(e):this.readMessageLoginLogoutFromServer(e)}readMessageReadMessageFromServer(e){T.changeStatusToRead(e)}readMessageDeliveryMessageFromServer(e){T.changeStatusToDelivery(e)}readMessageEditMessageFromServer(e){T.editMessageInChat(e)}readMessageDeleteMessageFromServer(e){T.deleteMessage(e)}readMessageLoginLogoutFromServer(e){T.updateStatusUser(e.payload.user)}readMessageNewMessageFromServer(e){T.showNewMessage(e)}readErrorMessage(e){s.showModal(e.payload.error)}readMessageLogin(e){var t;i.saveUserToLS(e.payload.user,null===(t=T.getActiveUser())||void 0===t?void 0:t.password),T.setActiveUser(),this.sendRequestsForAllUsers(),d.main()}readMessageAllUsers(e,t){const s=e.payload.users;N.mainPage.updateUsers(s,t)}sendMessage(e){this.waitForSendMessage((()=>this.socket.send(JSON.stringify(e)))),this.requests.push({id:e.id,type:e.type,user:this.getUserFromMsg(e)}),this.id+=1}getUserFromMsg(e){return e.payload&&"user"in e.payload?e.payload.user.login:""}checkServerStatus(){return 0===this.socket.readyState&&this.waitForConnect((()=>s.showModal("Connecting to server!"))),1===this.socket.readyState||3===this.socket.readyState&&this.waitForConnect((()=>s.showModal("No connection with server!"))),!0}waitForConnect(e){setTimeout((()=>{1===this.socket.readyState?s.hideModal():this.waitForConnect(e)}),5)}waitForSendMessage(e){setTimeout((()=>{1===this.socket.readyState?(s.hideModal(),e()):this.waitForSendMessage(e)}),5)}sendRequestForUserLogin(e,t){if(this.checkServerStatus()){const s=this.message.getRequestForLogin(this.id,e,t);this.sendMessage(s)}}sendRequestForUserLogout(e){if(this.checkServerStatus()){const t=this.message.getRequestForLogout(this.id,e);this.sendMessage(t)}}sendRequestForOnlineUsers(){if(this.checkServerStatus()){const e=this.message.getRequestForOnlineUsers(this.id);this.sendMessage(e)}}sendRequestForOfflineUsers(){if(this.checkServerStatus()){const e=this.message.getRequestForOfflineUsers(this.id);this.sendMessage(e)}}sendRequestsForAllUsers(){this.sendRequestForOnlineUsers(),this.sendRequestForOfflineUsers()}sendRequestForMessage(e,t){if(this.checkServerStatus()){const s=this.message.getRequestForMessageToUser(this.id,e,t);this.sendMessage(s)}}sendRequestForUnreadMessage(e){if(this.checkServerStatus()){const t=this.message.getRequestForHistoryMessageFromUser(this.id,e);this.sendMessage(t)}}sentRequestForStatusRead(e){if(this.checkServerStatus()){const t=this.message.getRequestForStatusRead(this.id,e);this.sendMessage(t)}}closeConnection(){this.socket.close()}sendRequestForMessageDelete(e){if(this.checkServerStatus()){const t=this.message.getRequestForMessageDelete(this.id,e);this.sendMessage(t)}}sendRequestForMessageEdit(e,t){if(this.checkServerStatus()){const s=this.message.getRequestForMessageEdit(this.id,e,t);this.sendMessage(s)}}};function u(e,t,s){const i=e.value.trim();if(!1===t.test(i)){e.classList.remove("form__login__item-valid"),e.classList.add("form__login__item-notvalid");const t=e.nextElementSibling;return t&&(t.textContent=s),!1}return e.classList.add("form__login__item-valid"),!0}function m(e){return!(!function(e,t){if(!e.value.trim().length){e.classList.remove("form__login__item-valid"),e.classList.add("form__login__item-notvalid");const t=e.nextElementSibling;return t&&(t.textContent="The field is required!"),!1}return e.classList.add("form__login__item-valid"),!0}(e)||"text"===e.type&&!u(e,/^[a-zA-Z-]+$/,"Only English letters and the hyphen ara allowed")||!u(e,/.{4}/,"The field should contain minimal 4 characters")||"password"===e.type&&!u(e,/[a-zA-Z]+/,"The passwors should contain minimal one English letter"))}const p='<svg class="statusMessage__ico" width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M2 12L7.25 17C7.25 17 8.66939 15.3778 9.875 14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M8 12L13.25 17L22 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M16 7L12.5 11" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>',v='<svg class="actionMessage__ico" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M15.6287 5.12132L4.31497 16.435M15.6287 5.12132L19.1642 8.65685M15.6287 5.12132L17.0429 3.70711C17.4334 3.31658 18.0666 3.31658 18.4571 3.70711L20.5784 5.82843C20.969 6.21895 20.969 6.85212 20.5784 7.24264L19.1642 8.65685M7.85051 19.9706L4.31497 16.435M7.85051 19.9706L19.1642 8.65685M7.85051 19.9706L3.25431 21.0312L4.31497 16.435" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>',w='<svg class="about__ico" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <rect id="Icons" x="-640" y="-192" width="1280" height="800" style="fill:none;"></rect> <g id="Icons1" serif:id="Icons"> <g id="Strike"> </g> <g id="H1"> </g> <g id="H2"> </g> <g id="H3"> </g> <g id="list-ul"> </g> <g id="hamburger-1"> </g> <g id="hamburger-2"> </g> <g id="list-ol"> </g> <g id="list-task"> </g> <g id="trash"> </g> <g id="vertical-menu"> </g> <g id="horizontal-menu"> </g> <g id="sidebar-2"> </g> <g id="Pen"> </g> <g id="Pen1" serif:id="Pen"> </g> <g id="clock"> </g> <g id="external-link"> </g> <g id="hr"> </g> <g id="info"> </g> <g id="warning"> </g> <g id="plus-circle"> </g> <g id="minus-circle"> </g> <g id="vue"> </g> <g id="cog"> </g> <g id="logo"> </g> <path id="question" d="M27.952,42.387c0.043,-2.56 0.333,-4.583 0.871,-6.068c0.538,-1.485 1.636,-3.131 3.293,-4.939l4.229,-4.358c1.807,-2.044 2.711,-4.239 2.711,-6.585c0,-2.259 -0.592,-4.029 -1.775,-5.31c-1.184,-1.28 -2.905,-1.92 -5.165,-1.92c-2.195,0 -3.96,0.581 -5.294,1.743c-1.334,1.162 -2.001,2.722 -2.001,4.68l-5.972,0c0.043,-3.486 1.286,-6.3 3.728,-8.441c2.443,-2.141 5.622,-3.212 9.539,-3.212c4.067,0 7.236,1.092 9.506,3.277c2.271,2.184 3.406,5.181 3.406,8.99c0,3.765 -1.743,7.478 -5.229,11.136l-3.519,3.486c-1.571,1.743 -2.356,4.25 -2.356,7.521l-5.972,0Zm-0.258,10.233c0,-0.968 0.296,-1.781 0.887,-2.437c0.592,-0.656 1.469,-0.985 2.631,-0.985c1.162,0 2.045,0.329 2.647,0.985c0.603,0.656 0.904,1.469 0.904,2.437c0,0.969 -0.301,1.77 -0.904,2.405c-0.602,0.635 -1.485,0.952 -2.647,0.952c-1.162,0 -2.039,-0.317 -2.631,-0.952c-0.591,-0.635 -0.887,-1.436 -0.887,-2.405Z" style="fill-rule:nonzero;"></path> <g id="radio-check"> </g> <g id="eye-slash"> </g> <g id="eye"> </g> <g id="toggle-off"> </g> <g id="shredder"> </g> <g id="spinner--loading--dots-" serif:id="spinner [loading, dots]"> </g> <g id="react"> </g> <g id="check-selected"> </g> <g id="turn-off"> </g> <g id="code-block"> </g> <g id="user"> </g> <g id="coffee-bean"> </g> <g id="coffee-beans"> <g id="coffee-bean1" serif:id="coffee-bean"> </g> </g> <g id="coffee-bean-filled"> </g> <g id="coffee-beans-filled"> <g id="coffee-bean2" serif:id="coffee-bean"> </g> </g> <g id="clipboard"> </g> <g id="clipboard-paste"> </g> <g id="clipboard-copy"> </g> <g id="Layer1"> </g> </g> </g></svg>';class f extends t{constructor(){super({tag:"form",classNames:["login__form"]}),this.user=this.createFormInputElement(["login__form__input"],"login_login","text"),this.password=this.createFormInputElement(["login__form__input","login__form__input-password"],"login_password","password"),this.btnLogin=this.createFormSubmitElement(),this.btnAbout=this.createBtnAbout(),this.prepareForm()}createBtnAbout(){const e=new t({tag:"button",classNames:["btn","btn-login-about"]}).getElement();return e.innerHTML=w,e.title="About app",e.addEventListener("click",(()=>this.goToPageAbout())),e}createFormSubmitElement(){const e=new t({tag:"button",classNames:["btn","btn-action","btn-login"],text:"Login"}).getElement();return e.addEventListener("click",(e=>this.login(e))),e}createFormInputElement(e,s,i){const a=new t({tag:"input",classNames:e}).getElement();return a.id=s,a.required=!0,a.type=i,a.addEventListener("focusin",(()=>function(e){e.classList.remove("form__login__item-notvalid");const t=e.nextElementSibling;t&&(t.textContent="")}(a))),a.addEventListener("focusout",(()=>function(e){m(e)}(a))),a}prepareForm(){const e=this.createFormItem("Login",this.user,"login_login"),t=this.createFormItem("Password",this.password,"login_password");this.getElement().append(this.btnAbout,e,t,this.btnLogin)}createFormItem(e,t,s){const i=this.createFormItemWrapper(),a=this.createFormLabel(e,s),r=this.createFormMessage();return i.append(a,t,r),i}createFormItemWrapper(){return new t({tag:"div",classNames:["login__form__item"]}).getElement()}createFormLabel(e,s){const i=new t({tag:"label",classNames:["login__form__item__label"],text:e}).getElement();return i.setAttribute("for",s),i}createFormMessage(){return new t({tag:"span",classNames:["login__form__item__message"]}).getElement()}login(e){e.preventDefault(),function(e){for(let t=0;t<e.length;t+=1)if(!m(e[t]))return!1;return!0}([this.user,this.password])&&(T.setCurrentUser(this.user.value.trim(),this.password.value.trim()),c.sendRequestForUserLogin(this.user.value.trim(),this.password.value.trim()))}clearForm(){this.user.value="",this.password.value="",this.user.classList.remove("form__login__item-valid"),this.password.classList.remove("form__login__item-valid")}goToPageAbout(){d.about()}}class M{constructor(){this.container=new t({tag:"div",classNames:["container","container__login"]}).getElement(),this.loginForm=new f,this.createPage()}createPage(){this.container.append(this.loginForm.getElement())}getPage(){return this.container}clearLoginForm(){this.loginForm.clearForm()}}class _ extends t{constructor(){super({tag:"footer",classNames:["footer"]}),this.rsschool=this.createFooterItem("https://rs.school/",'<svg class="footer__ico" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 552.8 205.3" width="100px"><style>.st0{fill:#fff}.st1{clip-path:url(#SVGID_2_)}.st2{clip-path:url(#SVGID_4_)}.st3{clip-path:url(#SVGID_6_)}.st4{clip-path:url(#SVGID_8_)}.st5{fill:#fff;stroke-width:4;stroke-miterlimit:10}.st6{clip-path:url(#SVGID_8_)}.st6,.st7{fill:none;stroke:#000;stroke-width:4;stroke-miterlimit:10}.st8,.st9{clip-path:url(#SVGID_10_)}.st9{fill:none;stroke:#000;stroke-width:4;stroke-miterlimit:10}</style><title>rs_school_js</title><path d="M285.4 68l26.3-1.7c.6 4.3 1.7 7.5 3.5 9.8 2.9 3.6 6.9 5.4 12.2 5.4 3.9 0 7-.9 9.1-2.8 2-1.5 3.2-3.9 3.2-6.4 0-2.4-1.1-4.7-3-6.2-2-1.8-6.7-3.6-14.1-5.2-12.1-2.7-20.8-6.3-25.9-10.9-5.1-4.3-8-10.6-7.8-17.3 0-4.6 1.4-9.2 4-13 3-4.3 7.1-7.7 12-9.6 5.3-2.3 12.7-3.5 22-3.5 11.4 0 20.1 2.1 26.1 6.4 6 4.2 9.6 11 10.7 20.3l-26 1.5c-.7-4-2.1-6.9-4.4-8.8s-5.3-2.8-9.2-2.8c-3.2 0-5.6.7-7.2 2-1.5 1.2-2.5 3-2.4 5 0 1.5.8 2.9 2 3.8 1.3 1.2 4.4 2.3 9.3 3.3 12.1 2.6 20.7 5.2 26 7.9 5.3 2.7 9.1 6 11.4 9.9 2.4 4 3.6 8.6 3.5 13.3 0 5.6-1.6 11.2-4.8 15.9-3.3 4.9-7.9 8.7-13.3 11-5.7 2.5-12.9 3.8-21.5 3.8-15.2 0-25.7-2.9-31.6-8.8S286.1 77 285.4 68zM6.3 97.6V8.2h46.1c8.5 0 15.1.7 19.6 2.2 4.4 1.4 8.3 4.3 10.9 8.2 2.9 4.3 4.3 9.3 4.2 14.5.3 8.8-4.2 17.2-11.9 21.6-3 1.7-6.3 2.9-9.7 3.5 2.5.7 5 1.9 7.2 3.3 1.7 1.4 3.1 3 4.4 4.7 1.5 1.7 2.8 3.6 3.9 5.6l13.4 25.9H63L48.2 70.2c-1.9-3.5-3.5-5.8-5-6.9-2-1.4-4.4-2.1-6.8-2.1H34v36.3H6.3zM34 44.4h11.7c2.5-.2 4.9-.6 7.3-1.2 1.8-.3 3.4-1.3 4.5-2.8 2.7-3.6 2.3-8.7-1-11.8-1.8-1.5-5.3-2.3-10.3-2.3H34v18.1zM0 174.2l26.3-1.7c.6 4.3 1.7 7.5 3.5 9.8 2.8 3.6 6.9 5.5 12.2 5.5 3.9 0 7-.9 9.1-2.8 2-1.6 3.2-3.9 3.2-6.4 0-2.4-1.1-4.7-3-6.2-2-1.8-6.7-3.6-14.2-5.2-12.1-2.7-20.8-6.3-25.9-10.9-5.1-4.3-8-10.6-7.8-17.3 0-4.6 1.4-9.2 4-13 3-4.3 7.1-7.7 12-9.6 5.3-2.3 12.7-3.5 22-3.5 11.4 0 20.1 2.1 26.1 6.4s9.5 11 10.6 20.3l-26 1.5c-.7-4-2.1-6.9-4.4-8.8-2.2-1.9-5.3-2.8-9.2-2.7-3.2 0-5.6.7-7.2 2.1-1.6 1.2-2.5 3-2.4 5 0 1.5.8 2.9 2 3.8 1.3 1.2 4.4 2.3 9.3 3.3 12.1 2.6 20.7 5.2 26 7.9 5.3 2.7 9.1 6 11.4 9.9 2.4 4 3.6 8.6 3.6 13.2 0 5.6-1.7 11.1-4.8 15.8-3.3 4.9-7.9 8.7-13.3 11-5.7 2.5-12.9 3.8-21.5 3.8-15.2 0-25.7-2.9-31.6-8.8-5.9-6-9.2-13.4-10-22.4z"/><path d="M133 167.2l24.2 7.3c-1.3 6.1-4 11.9-7.7 17-3.4 4.5-7.9 8-13 10.3-5.2 2.3-11.8 3.5-19.8 3.5-9.7 0-17.7-1.4-23.8-4.2-6.2-2.8-11.5-7.8-16-14.9-4.5-7.1-6.7-16.2-6.7-27.3 0-14.8 3.9-26.2 11.8-34.1s19-11.9 33.4-11.9c11.3 0 20.1 2.3 26.6 6.8 6.4 4.6 11.2 11.6 14.4 21l-24.4 5.4c-.6-2.1-1.5-4.2-2.7-6-1.5-2.1-3.4-3.7-5.7-4.9-2.3-1.2-4.9-1.7-7.5-1.7-6.3 0-11.1 2.5-14.4 7.6-2.5 3.7-3.8 9.6-3.8 17.6 0 9.9 1.5 16.7 4.5 20.4 3 3.7 7.2 5.5 12.7 5.5 5.3 0 9.3-1.5 12-4.4 2.7-3.1 4.7-7.4 5.9-13zm56.5-52.8h27.6v31.3h30.2v-31.3h27.8v89.4h-27.8v-36.2h-30.2v36.2h-27.6v-89.4z"/><path d="M271.3 159.1c0-14.6 4.1-26 12.2-34.1 8.1-8.1 19.5-12.2 34-12.2 14.9 0 26.3 4 34.4 12S364 144 364 158.4c0 10.5-1.8 19-5.3 25.7-3.4 6.6-8.7 12-15.2 15.6-6.7 3.7-15 5.6-24.9 5.6-10.1 0-18.4-1.6-25-4.8-6.8-3.4-12.4-8.7-16.1-15.2-4.1-7-6.2-15.7-6.2-26.2zm27.6.1c0 9 1.7 15.5 5 19.5 3.3 3.9 7.9 5.9 13.7 5.9 5.9 0 10.5-1.9 13.8-5.8s4.9-10.8 4.9-20.8c0-8.4-1.7-14.6-5.1-18.4-3.4-3.9-8-5.8-13.8-5.8-5.1-.2-10 2-13.4 5.9-3.4 3.9-5.1 10.4-5.1 19.5zm93.4-.1c0-14.6 4.1-26 12.2-34.1 8.1-8.1 19.5-12.2 34-12.2 14.9 0 26.4 4 34.4 12S485 144 485 158.4c0 10.5-1.8 19-5.3 25.7-3.4 6.6-8.7 12-15.2 15.6-6.7 3.7-15 5.6-24.9 5.6-10.1 0-18.4-1.6-25-4.8-6.8-3.4-12.4-8.7-16.1-15.2-4.1-7-6.2-15.7-6.2-26.2zm27.6.1c0 9 1.7 15.5 5 19.5 3.3 3.9 7.9 5.9 13.7 5.9 5.9 0 10.5-1.9 13.8-5.8 3.3-3.9 4.9-10.8 4.9-20.8 0-8.4-1.7-14.6-5.1-18.4-3.4-3.9-8-5.8-13.8-5.8-5.1-.2-10.1 2-13.4 5.9-3.4 3.9-5.1 10.4-5.1 19.5z"/><path d="M482.1 114.4h27.6v67.4h43.1v22H482v-89.4z"/><ellipse transform="rotate(-37.001 420.46 67.88)" class="st0" cx="420.5" cy="67.9" rx="63" ry="51.8"/><defs><ellipse id="SVGID_1_" transform="rotate(-37.001 420.46 67.88)" cx="420.5" cy="67.9" rx="63" ry="51.8"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><g class="st1"><path transform="rotate(-37.001 420.82 68.353)" class="st0" d="M330.9-14.2h179.8v165.1H330.9z"/><g id="Layer_2_1_"><defs><path id="SVGID_3_" transform="rotate(-37.001 420.82 68.353)" d="M330.9-14.2h179.8v165.1H330.9z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" overflow="visible"/></clipPath><g id="Layer_1-2" class="st2"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st0" cx="420.5" cy="67.9" rx="63" ry="51.8"/><defs><ellipse id="SVGID_5_" transform="rotate(-37.001 420.46 67.88)" cx="420.5" cy="67.9" rx="63" ry="51.8"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" overflow="visible"/></clipPath><g class="st3"><path transform="rotate(-37 420.799 68.802)" class="st0" d="M357.8 17h125.9v103.7H357.8z"/><defs><path id="SVGID_7_" transform="rotate(-37 420.799 68.802)" d="M357.8 17h125.9v103.7H357.8z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" overflow="visible"/></clipPath><g class="st4"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st5" cx="420.5" cy="67.9" rx="63" ry="51.8"/></g><path transform="rotate(-37 420.799 68.802)" class="st6" d="M357.8 17h125.9v103.7H357.8z"/><ellipse transform="rotate(-37.001 420.46 67.88)" class="st7" cx="420.5" cy="67.9" rx="63" ry="51.8"/><path transform="rotate(-37 420.799 68.802)" class="st0" d="M357.8 17h125.9v103.7H357.8z"/><defs><path id="SVGID_9_" transform="rotate(-37 420.799 68.802)" d="M357.8 17h125.9v103.7H357.8z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" overflow="visible"/></clipPath><g class="st8"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st5" cx="420.5" cy="67.9" rx="63" ry="51.8"/></g><path transform="rotate(-37 420.799 68.802)" class="st9" d="M357.8 17h125.9v103.7H357.8z"/><path transform="rotate(-37.001 420.82 68.353)" class="st7" d="M330.9-14.2h179.8v165.1H330.9z"/></g><ellipse transform="rotate(-37.001 420.46 67.88)" class="st7" cx="420.5" cy="67.9" rx="63" ry="51.8"/><path d="M392.4 61.3l10-7 12.3 17.5c2.1 2.8 3.7 5.8 4.9 9.1.7 2.5.5 5.2-.5 7.6-1.3 3-3.4 5.5-6.2 7.3-3.3 2.3-6.1 3.6-8.5 4-2.3.4-4.7 0-6.9-1-2.4-1.2-4.5-2.9-6.1-5.1l8.6-8c.7 1.1 1.6 2.1 2.6 2.9.7.5 1.5.8 2.4.8.7 0 1.4-.3 1.9-.7 1-.6 1.7-1.8 1.6-3-.3-1.7-1-3.4-2.1-4.7l-14-19.7zm30 11.1l9.1-7.2c1 1.2 2.3 2.1 3.7 2.6 2 .6 4.1.2 5.8-1.1 1.2-.8 2.2-1.9 2.6-3.3.6-1.8-.4-3.8-2.2-4.4-.3-.1-.6-.2-.9-.2-1.2-.1-3.3.4-6.4 1.7-5.1 2.1-9.1 2.9-12.1 2.6-2.9-.3-5.6-1.8-7.2-4.3-1.2-1.7-1.8-3.7-1.9-5.7 0-2.3.6-4.6 1.9-6.5 1.9-2.7 4.2-5 7-6.8 4.2-2.9 7.9-4.3 11.1-4.3 3.2 0 6.2 1.5 9 4.6l-9 7.1c-1.8-2.3-5.2-2.8-7.5-1l-.3.3c-1 .6-1.7 1.5-2.1 2.6-.3.8-.1 1.7.4 2.4.4.5 1 .9 1.7.9.8.1 2.2-.3 4.2-1.2 5-2.1 8.8-3.3 11.4-3.7 2.2-.4 4.5-.2 6.6.7 1.9.8 3.5 2.2 4.6 3.9 1.4 2 2.2 4.4 2.3 6.9.1 2.6-.6 5.1-2 7.3-1.8 2.7-4.1 5-6.8 6.8-5.5 3.8-10 5.4-13.6 4.8-3.9-.6-7.1-2.6-9.4-5.5z"/></g></g></g></svg>'),this.github=this.createFooterItem("https://github.com/Zarembochka",'<svg class="footer__ico" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 64 64" width="55px" height="55px"><path d="M32 6C17.641 6 6 17.641 6 32c0 12.277 8.512 22.56 19.955 25.286-.592-.141-1.179-.299-1.755-.479V50.85c0 0-.975.325-2.275.325-3.637 0-5.148-3.245-5.525-4.875-.229-.993-.827-1.934-1.469-2.509-.767-.684-1.126-.686-1.131-.92-.01-.491.658-.471.975-.471 1.625 0 2.857 1.729 3.429 2.623 1.417 2.207 2.938 2.577 3.721 2.577.975 0 1.817-.146 2.397-.426.268-1.888 1.108-3.57 2.478-4.774-6.097-1.219-10.4-4.716-10.4-10.4 0-2.928 1.175-5.619 3.133-7.792C19.333 23.641 19 22.494 19 20.625c0-1.235.086-2.751.65-4.225 0 0 3.708.026 7.205 3.338C28.469 19.268 30.196 19 32 19s3.531.268 5.145.738c3.497-3.312 7.205-3.338 7.205-3.338.567 1.474.65 2.99.65 4.225 0 2.015-.268 3.19-.432 3.697C46.466 26.475 47.6 29.124 47.6 32c0 5.684-4.303 9.181-10.4 10.4 1.628 1.43 2.6 3.513 2.6 5.85v8.557c-.576.181-1.162.338-1.755.479C49.488 54.56 58 44.277 58 32 58 17.641 46.359 6 32 6zM33.813 57.93C33.214 57.972 32.61 58 32 58 32.61 58 33.213 57.971 33.813 57.93zM37.786 57.346c-1.164.265-2.357.451-3.575.554C35.429 57.797 36.622 57.61 37.786 57.346zM32 58c-.61 0-1.214-.028-1.813-.07C30.787 57.971 31.39 58 32 58zM29.788 57.9c-1.217-.103-2.411-.289-3.574-.554C27.378 57.61 28.571 57.797 29.788 57.9z"/></svg>'),this.year=this.createYear(),this.prepareFooter()}prepareFooter(){this.getElement().append(this.rsschool,this.year,this.github)}createFooterItem(e,s){const i=new t({tag:"a",classNames:["footer__item"]}).getElement();return i.href=e,i.setAttribute("target","_blank"),i.innerHTML=s,i}createYear(){return new t({tag:"span",classNames:["footer__item"],text:"2024"}).getElement()}}class E extends t{constructor(){super({tag:"header",classNames:["header"]}),this.title=this.createTitle(),this.btnLogout=this.createBtnLogout(),this.btnAbout=this.createBtnAbout(),this.prepareHeader()}prepareHeader(){this.getElement().append(this.title,this.btnAbout,this.btnLogout)}createTitle(){return new t({tag:"h1",classNames:["header__title"],text:"Fun-chat"}).getElement()}createBtnLogout(){const e=new t({tag:"button",classNames:["btn","btn-action","btn-logout"],text:"Logout"}).getElement();return e.addEventListener("click",(()=>this.logout())),e}createBtnAbout(){const e=new t({tag:"button",classNames:["btn","btn-about"]}).getElement();return e.innerHTML=w,e.title="About app",e.addEventListener("click",(()=>this.about())),e}setUserName(){this.title.textContent=`Fun-chat: ${this.getUsername()}`}logout(){i.removeUser(),d.start(),T.logout()}getUsername(){var e;return(null===(e=T.getActiveUser())||void 0===e?void 0:e.login)||""}about(){d.about()}}class S extends t{constructor(){super({tag:"aside",classNames:["users"]}),this.search=this.createInputElement(),this.userList=this.createUsersList(),this.user=null,this.onlineUsers=[],this.offlineUsers=[],this.prepareUsers()}prepareUsers(){this.search.addEventListener("keyup",(()=>this.findUsers())),this.getElement().append(this.search,this.userList),window.addEventListener("new-message",(e=>this.showNewMessageIco(e))),window.addEventListener("unread-messages",(e=>this.showUnreadMessagesIco(e))),window.addEventListener("user-change-status",(e=>this.updateStatus(e))),window.addEventListener("user-change",(e=>this.updateUser(e))),window.addEventListener("logout",(()=>this.clearUsers()))}updateUser(e){if(e instanceof CustomEvent){const t=e.detail.user;this.user=t}}createInputElement(){const e=new t({tag:"input",classNames:["users__search"]}).getElement();return e.type="text",e.placeholder="...Search",e}createUsersList(){return new t({tag:"ul",classNames:["users__list"]}).getElement()}createUsersItem(e,s){const i=new t({tag:"li",classNames:["users__list__item",s]}).getElement(),a=new t({tag:"span",classNames:["users__list__item__status"]}).getElement();a.innerHTML='<svg class="status__ico" width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M2 9.1371C2 14 6.01943 16.5914 8.96173 18.9109C10 19.7294 11 20.5 12 20.5C13 20.5 14 19.7294 15.0383 18.9109C17.9806 16.5914 22 14 22 9.1371C22 4.27416 16.4998 0.825464 12 5.50063C7.50016 0.825464 2 4.27416 2 9.1371Z"></path> </g></svg>';const r=new t({tag:"span",classNames:["users__list__item__login"],text:e}).getElement(),n=new t({tag:"span",classNames:["users__list__item__ico"]}).getElement();return i.append(a,r,n),i.addEventListener("click",(()=>this.selectUser(e,s))),i}selectUser(e,t){this.showUserInfo(e,t),c.sendRequestForUnreadMessage(e)}showUserInfo(e,t){T.selectUser({login:e,isLogined:"active"===t})}updateUsers(e,t,s){this.removeOldUsers(t),e.forEach((e=>{if(e.login!==(null==s?void 0:s.login)){const s=this.createUsersItem(e.login,t);this.userList.append(s),c.sendRequestForUnreadMessage(e.login),t===o.active?this.onlineUsers.push(e):this.offlineUsers.push(e)}}))}updateUserList(e,t,s){this.removeOldUsers(t),e.forEach((e=>{if(e.login!==(null==s?void 0:s.login)){const s=this.createUsersItem(e.login,t);this.userList.append(s),c.sendRequestForUnreadMessage(e.login)}}))}removeOldUsers(e){[...document.querySelectorAll(`.users__list__item.${e}`)].forEach((e=>e.remove()))}clearUsers(){for(this.user=null,this.onlineUsers.length=0,this.offlineUsers.length=0;this.userList.firstChild;)this.userList.firstChild.remove()}findUsers(){const e=this.search.value;this.hideOtherUsers(e)}hideOtherUsers(e){const t=[...document.querySelectorAll(".users__list__item__login")];t.forEach((e=>{var t;return null===(t=e.parentElement)||void 0===t?void 0:t.classList.add("hide")})),t.filter((t=>{var s;return null===(s=t.textContent)||void 0===s?void 0:s.includes(e)})).forEach((e=>{var t;return null===(t=e.parentElement)||void 0===t?void 0:t.classList.remove("hide")}))}showNewMessageIco(e){if(e instanceof CustomEvent){const t=e.detail.from,s=this.findUser(t),i=this.msgsCount(s);s&&s.nextElementSibling&&(s.nextElementSibling.textContent=String(i+1),s.nextElementSibling.classList.add("show"))}}msgsCount(e){let t=0;return e&&e.nextElementSibling&&e.nextElementSibling.textContent&&(t=parseInt(e.nextElementSibling.textContent)),t}findUser(e){return[...document.querySelectorAll(".users__list__item__login")].find((t=>t.textContent===e))}showUnreadMessagesIco(e){if(e instanceof CustomEvent){const t=e.detail.from,s=this.findUser(t),i=e.detail.count;if(s&&s.nextElementSibling){if(s.nextElementSibling.textContent=String(i),i>0)return void s.nextElementSibling.classList.add("show");s.nextElementSibling.classList.remove("show")}}}updateStatus(e){if(e instanceof CustomEvent){const t=e.detail.user.login;this.changeStatusForUser(t)||(e.detail.user.isLogined?this.onlineUsers.push(e.detail.user):this.offlineUsers.push(e.detail.user)),this.showNewUsers()}}showNewUsers(){this.onlineUsers.sort(((e,t)=>e.login.localeCompare(t.login))),this.offlineUsers.sort(((e,t)=>e.login.localeCompare(t.login))),this.updateUserList(this.onlineUsers,o.active,T.getActiveUser()),this.updateUserList(this.offlineUsers,o.nonactive,T.getActiveUser())}changeStatusForUser(e){const t=this.findActiveUser(e);if(t)return this.removeUserFromActive(t),!0;{const t=this.findInactiveUser(e);if(t)return this.removeUserFromInactive(t),!0}return!1}findActiveUser(e){return this.onlineUsers.find((t=>t.login===e))}removeUserFromActive(e){const t=this.onlineUsers.filter((t=>t.login!==e.login));this.onlineUsers=[...t],this.offlineUsers.push(e)}findInactiveUser(e){return this.offlineUsers.find((t=>t.login===e))}removeUserFromInactive(e){const t=this.offlineUsers.filter((t=>t.login!==e.login));this.offlineUsers=[...t],this.onlineUsers.push(e)}}class L extends t{constructor(e,t,s,i,a){super({tag:"div",classNames:["message"]}),this.id=e,this.header=this.createHTMLElement("message__header",t),this.body=this.createHTMLElement("message__body"),this.content=this.createHTMLElement("message__body__content",i),this.btnDelete=this.createBtnElement("btn-delete",'<svg class="actionMessage__ico" width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M5 7.5H19L18 21H6L5 7.5Z" stroke-linejoin="round"></path> <path d="M15.5 9.5L15 19" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 9.5V19" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M8.5 9.5L9 19" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M16 5H19C20.1046 5 21 5.89543 21 7V7.5H3V7C3 5.89543 3.89543 5 5 5H8M16 5L15 3H9L8 5M16 5H8" stroke-linejoin="round"></path> </g></svg>',"delete"),this.btnEdit=this.createBtnElement("btn-edit",v,"edit"),this.footer=this.createHTMLElement("message__footer"),this.time=this.createHTMLElement("message__footer__time",this.getDate(s)),this.status=this.createHTMLElement("message__footer__status"),this.statusEdited=this.createHTMLElement("message__footer__statusEdited"),this.status.innerHTML=p,this.prepareMessage(a)}prepareMessage(e){this.setStatusesForMessage(e),this.btnDelete.addEventListener("click",(()=>this.deleteMessage())),this.btnEdit.addEventListener("click",(()=>this.editMessage())),this.body.append(this.btnDelete,this.btnEdit,this.content),this.footer.append(this.time,this.statusEdited,this.status),this.getElement().append(this.header,this.body,this.footer)}setStatusesForMessage(e){e.isEdited&&this.changeStatusToEdited(),e.isDelivered&&this.setStatusDelivered(),e.isReaded&&this.setStatusRead()}setStatusDelivered(){this.status.innerHTML='<svg class="statusMessage__ico" width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M2 12L7.25 17C7.25 17 8.66939 15.3778 9.875 14" stroke="#0bbf2f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M8 12L13.25 17L22 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M16 7L12.5 11" stroke="#0bbf2f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>'}setStatusRead(){this.status.innerHTML=p,this.status.classList.add("readed")}getDate(e){const t=new Date(e),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return`${t.getDate()}/${s}/${t.getFullYear()}  ${i}.${a}`}createHTMLElement(e,s){return new t({tag:"div",classNames:[e],text:s}).getElement()}createBtnElement(e,s,i){const a=new t({tag:"button",classNames:["btn","btn-message",e]}).getElement();return a.innerHTML=s,a.title=`${i} message`,a}deleteMessage(){c.sendRequestForMessageDelete(this.id)}editMessage(){this.content.textContent&&T.editMessage(this.id,this.content.textContent)}editTextMessage(e){this.content.textContent=e,this.changeStatusToEdited()}changeStatusToEdited(){this.statusEdited.innerHTML=v}}class U extends t{constructor(){super({tag:"main",classNames:["chat__dialog"]}),this.user=null,this.startMessage=new t({tag:"div",classNames:["chat__startDialog"],text:"Select user to start chat!"}).getElement(),this.separateLine=new t({tag:"div",classNames:["chat__separateLine"],text:"Unread messages"}).getElement(),this.unreadMessages=[],this.allMessages=[],this.prepareMain()}prepareMain(){this.showStartMessage(),window.addEventListener("user-change",(e=>this.updateUser(e))),window.addEventListener("history-dialog",(e=>this.showDialog(e))),window.addEventListener("new-message",(e=>this.showNewMessage(e))),window.addEventListener("logout",(()=>this.logout())),window.addEventListener("delete-message",(e=>this.removeMessageFromChat(e))),window.addEventListener("edited-message",(e=>this.editedMessageInChat(e))),window.addEventListener("change-status",(e=>this.changeStatus(e))),this.startListenToReadMessagesClick()}startListenToReadMessages(){this.startListenToReadMessagesClick()}startListenToReadMessagesScroll(){this.getElement().addEventListener("scroll",this.readAllMessages.bind(this),!1)}startListenToReadMessagesClick(){this.getElement().addEventListener("click",this.readAllMessages.bind(this),!1)}readAllMessages(){this.removeSeparateLine(),this.user&&T.allMessagesRead(this.user.login),this.changeStatusForRead(),this.stopListenToReadMessages()}stopListenToReadMessages(){this.getElement().removeEventListener("scroll",this.readAllMessages,!1),this.getElement().removeEventListener("click",this.readAllMessages,!1)}removeSeparateLine(){this.separateLine.remove()}updateUser(e){if(this.removeOldMessades(),e instanceof CustomEvent){const t=e.detail.user;this.user=t,this.startMessage.textContent="Send your first message!",this.showStartMessage(),this.allMessages=[],this.unreadMessages=[]}}showDialog(e){if(this.user&&e instanceof CustomEvent&&this.user.login===e.detail.user){this.removeOldMessades();const t=e.detail.messages.messages;t.length&&this.showHistoryMessage(t)}}showStartMessage(){this.getElement().append(this.startMessage)}showHistoryMessage(e){const t=e.filter((e=>{var t;return e.status.isReaded||e.from===(null===(t=T.getActiveUser())||void 0===t?void 0:t.login)})),s=e.filter((e=>{var t;return!e.status.isReaded&&e.from!==(null===(t=T.getActiveUser())||void 0===t?void 0:t.login)}));this.showDialogWithUser(t),s.length&&(this.appendElement(this.separateLine),this.showDialogWithUser(s),this.scrollToUnreadMessages(),this.startListenToReadMessages())}showDialogWithUser(e){e.forEach((e=>{var t,s;const i=new L(e.id,e.from,e.datetime,e.text,e.status);this.allMessages.push(i);const a=i.getElement();e.from===(null===(t=T.getActiveUser())||void 0===t?void 0:t.login)&&a.classList.add("author"),this.appendElement(a),e.status.isReaded||e.to!==(null===(s=T.getActiveUser())||void 0===s?void 0:s.login)||this.unreadMessages.push(e)}))}removeOldMessades(){for(var e;this.getElement().firstElementChild;)null===(e=this.getElement().firstElementChild)||void 0===e||e.remove()}logout(){this.user=null,this.removeOldMessades(),this.showStartMessage()}scrollToLastMessage(e){this.isUnreadMessages()?this.scrollToUnreadMessages():e.scrollIntoView({block:"end",inline:"nearest",behavior:"smooth"})}scrollToUnreadMessages(){this.separateLine.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}showNewMessage(e){var t,s,i;if(this.user&&e instanceof CustomEvent&&(this.user.login===e.detail.from||e.detail.from===(null===(t=T.getActiveUser())||void 0===t?void 0:t.login))){this.removeStartMessage();const t=new L(e.detail.id,e.detail.from,e.detail.datetime,e.detail.text,e.detail.status);this.allMessages.push(t);const a=t.getElement();e.detail.from===(null===(s=T.getActiveUser())||void 0===s?void 0:s.login)&&(a.classList.add("author"),this.readAllMessages()),this.isUnreadMessages()||e.detail.from===(null===(i=T.getActiveUser())||void 0===i?void 0:i.login)||this.appendElement(this.separateLine),e.detail.status.isReaded||this.user.login!==e.detail.from||this.unreadMessages.push(e.detail),this.appendElement(a),this.scrollToLastMessage(a)}}removeStartMessage(){this.startMessage.remove()}changeStatusForRead(){this.unreadMessages.forEach((e=>c.sentRequestForStatusRead(e.id))),this.unreadMessages.length=0}isUnreadMessages(){return!!this.getElement().querySelector(".chat__separateLine")}removeMessageFromChat(e){if(e instanceof CustomEvent){const t=e.detail.id;this.removeMessage(t)}}removeMessage(e){const t=this.findMesssage(e);t&&(t.removeElement(),this.removeMessageFromAll(e),this.removeMessageFromUnread(e),this.checkChatLength())}findMesssage(e){return this.allMessages.find((t=>t.id===e))}removeMessageFromAll(e){const t=this.allMessages.filter((t=>t.id!==e));this.allMessages=[...t]}removeMessageFromUnread(e){const t=this.unreadMessages.filter((t=>t.id!==e));this.unreadMessages=[...t],this.unreadMessages.length||this.removeSeparateLine()}checkChatLength(){this.getElement().childElementCount||this.showStartMessage()}editedMessageInChat(e){if(e instanceof CustomEvent){const t=e.detail.id,s=e.detail.text;this.editMessage(t,s)}}editMessage(e,t){const s=this.findMesssage(e);s&&s.editTextMessage(t)}changeStatus(e){if(e instanceof CustomEvent){const t=e.detail.id,s=e.detail.status;this.changeStatusForMessage(t,s)}}changeStatusForMessage(e,t){const s=this.findMesssage(e);s&&s.setStatusesForMessage(t)}}class b extends t{constructor(){super({tag:"form",classNames:["message__form"]}),this.message=this.createFormInputElement(["message__form__input"]),this.btnSend=this.createFormSubmitElement(),this.user="",this.idEditMessage=null,this.prepareForm()}createFormSubmitElement(){const e=new t({tag:"button",classNames:["btn","btn-action","btn-send"],text:"Send"}).getElement();return e.disabled=!0,e.addEventListener("click",(e=>this.sendMessage(e))),e}createFormInputElement(e){const s=new t({tag:"input",classNames:e}).getElement();return s.placeholder="...Message",s.required=!0,s.disabled=!0,s.addEventListener("keyup",(()=>this.checkMessageLength())),s}prepareForm(){this.getElement().append(this.message,this.btnSend),window.addEventListener("user-change",(e=>this.enableForm(e))),window.addEventListener("edit-message",(e=>this.editMessage(e)))}enableForm(e){e instanceof CustomEvent&&(this.user=e.detail.user.login,this.message.disabled=!1)}checkMessageLength(){this.message.value.trim()?this.btnSend.disabled=!1:this.btnSend.disabled=!0}sendMessage(e){e.preventDefault(),T.getActiveUser()&&(this.idEditMessage?c.sendRequestForMessageEdit(this.idEditMessage,this.message.value.trim()):c.sendRequestForMessage(this.user,this.message.value.trim()),this.clearForm())}clearForm(){this.message.value="",this.idEditMessage=null}editMessage(e){e instanceof CustomEvent&&(this.idEditMessage=e.detail.id,this.message.value=e.detail.text,this.message.disabled=!1,this.btnSend.disabled=!1)}}class y extends t{constructor(){super({tag:"footer",classNames:["chat__footer"]}),this.messageForm=new b,this.prepareFooter()}prepareFooter(){this.getElement().append(this.messageForm.getElement())}}class k extends t{constructor(){super({tag:"header",classNames:["chat__header"]}),this.userName=new t({tag:"div",classNames:["chat__header__userName"]}).getElement(),this.userStatus=new t({tag:"div",classNames:["chat__header__userStatus"]}).getElement(),this.user=null,this.prepareHeader()}prepareHeader(){this.getElement().append(this.userName,this.userStatus),window.addEventListener("user-change",(e=>this.updateInfo(e))),window.addEventListener("user-change-status",(e=>this.updateStatus(e))),window.addEventListener("logout",(()=>this.logout()))}updateInfo(e){if(e instanceof CustomEvent){const t=e.detail.user;this.user=t,this.userName.textContent=t.login,this.changeUserStatus(t.isLogined)}}changeUserStatus(e){this.userStatus.textContent=e?"online":"offline",this.userStatus.classList.remove("online"),this.userStatus.classList.remove("offline"),this.userStatus.classList.add(e?"online":"offline")}updateStatus(e){var t;if(e instanceof CustomEvent){const s=e.detail.user;(null===(t=this.user)||void 0===t?void 0:t.login)===s.login&&this.changeUserStatus(s.isLogined)}}logout(){this.user=null,this.userName.textContent="",this.userStatus.textContent=""}}class x extends t{constructor(){super({tag:"article",classNames:["chat"]}),this.header=new k,this.dialog=new U,this.footer=new y,this.prepareChat()}prepareChat(){this.getElement().append(this.header.getElement(),this.dialog.getElement(),this.footer.getElement())}}class F extends t{constructor(){super({tag:"main",classNames:["main"]}),this.users=new S,this.chat=new x,this.prepareMainPart()}prepareMainPart(){this.getElement().append(this.users.getElement(),this.chat.getElement())}updateUsers(e,t){this.users.updateUsers(e,t,T.getActiveUser())}removeUsers(){this.users.clearUsers()}}class C{constructor(){this.container=new t({tag:"div",classNames:["container","container__main"]}).getElement(),this.header=new E,this.main=new F,this.footer=new _,this.createPage()}createPage(){this.container.append(this.header.getElement(),this.main.getElement(),this.footer.getElement())}getPage(){return this.container}setActiveUser(){this.header.setUserName()}updateUsers(e,t){this.main.updateUsers(e,t)}removeUsers(){this.main.removeUsers()}}class R{constructor(){this.container=new t({tag:"div",classNames:["container","container__about"]}).getElement(),this.wrapper=new t({tag:"div",classNames:["about"]}).getElement(),this.title=new t({tag:"h1",classNames:["about__title"],text:"Fun-chat"}).getElement(),this.description=new t({tag:"p",classNames:["about__description"],text:'This application was creating during the course "RSSchool: JS / Front-end. Stage 2". Have fun!!!'}).getElement(),this.author=this.createAuthor(),this.btnBack=this.createBtnBack(),this.createPage()}createAuthor(){const e=new t({tag:"a",classNames:["about__author"],text:"Author: Zarembochka"}).getElement();return e.href="https://github.com/Zarembochka",e.setAttribute("target","blank"),e}createBtnBack(){const e=new t({tag:"button",classNames:["btn","btn-action","btn-back"],text:"Go back"}).getElement();return e.addEventListener("click",(()=>this.goBack())),e}createPage(){this.wrapper.append(this.title,this.description,this.author,this.btnBack),this.container.append(this.wrapper)}getPage(){return this.container}goBack(){d.goBack()}}!function(e){if("/"===e.search[1]){const t=e.search.slice(1).split("&").map((function(e){return e.replace(/~and~/g,"&")})).join("?"),s=e.pathname.slice(0,-1)+t+e.hash;window.history.replaceState(null,"",s)}}(window.location);const N=new class{constructor(){this.loginPage=new M,this.mainPage=new C,this.aboutPage=new R}renderPage(e){document.body.innerHTML="",document.body.append(e.getPage(),s.getElement())}render(e){e!==a.login?e!==a.main?this.renderPage(this.aboutPage):this.renderPage(this.mainPage):this.renderPage(this.loginPage)}clearLoginForm(){this.loginPage.clearLoginForm()}},T=new class{constructor(){this.activeUser=null,this.unreadMessages=[]}selectUser(e){const t=new CustomEvent("user-change",{detail:{user:e}});window.dispatchEvent(t)}updateStatusUser(e){const t=new CustomEvent("user-change-status",{detail:{user:e}});window.dispatchEvent(t)}showNewMessage(e){const t=new CustomEvent("new-message",{detail:{id:e.payload.message.id,from:e.payload.message.from,to:e.payload.message.to,text:e.payload.message.text,datetime:e.payload.message.datetime,status:{isDelivered:e.payload.message.status.isDelivered,isReaded:e.payload.message.status.isReaded,isEdited:e.payload.message.status.isEdited}}});this.unreadMessages.push({login:e.payload.message.from,id:e.payload.message.id}),window.dispatchEvent(t)}showUnreadMessages(e,t){if(this.activeUser){const s=e.payload.messages.filter((e=>{var t;return e.to===(null===(t=this.activeUser)||void 0===t?void 0:t.login)})).filter((e=>!e.status.isReaded)),i=s.length;if(i>0){const e=new CustomEvent("unread-messages",{detail:{from:t,count:i}});window.dispatchEvent(e)}s.forEach((e=>{this.unreadMessages.push({login:e.to,id:e.id})}))}}showDialogHistory(e,t){if(this.activeUser){const s=e.payload.messages.filter((e=>{var t,s;return e.to===(null===(t=this.activeUser)||void 0===t?void 0:t.login)||e.from===(null===(s=this.activeUser)||void 0===s?void 0:s.login)}));if(s.length){const e=new CustomEvent("history-dialog",{detail:{user:t,messages:{messages:s}}});window.dispatchEvent(e)}}}allMessagesRead(e){const t=new CustomEvent("unread-messages",{detail:{from:e,count:0}});window.dispatchEvent(t),this.removeUnreadMessagesFromUser(e)}removeUnreadMessagesFromUser(e){const t=this.unreadMessages.filter((t=>t.login!==e));this.unreadMessages=[...t]}setCurrentUser(e,t){this.activeUser={login:e,password:t,isLogined:!1}}setActiveUser(){this.activeUser&&(this.activeUser.isLogined=!0)}getActiveUser(){return this.activeUser}logout(){if(this.activeUser){c.sendRequestForUserLogout(this.activeUser),this.activeUser=null;const e=new CustomEvent("logout",{detail:{}});window.dispatchEvent(e)}}deleteMessage(e){if(!e.payload.message.status.isDeleted)return;const t=new CustomEvent("delete-message",{detail:{id:e.payload.message.id}});window.dispatchEvent(t),this.checkUnreadMessage(e.payload.message.id)}updateUnreadMessages(e,t){const s=new CustomEvent("unread-messages",{detail:{from:e,count:t}});window.dispatchEvent(s)}checkUnreadMessage(e){const t=this.unreadMessages.find((t=>t.id===e));if(t){const s=this.unreadMessages.filter((s=>s.login===t.login&&s.id!==e)).length;this.updateUnreadMessages(t.login,s);const i=this.unreadMessages.filter((t=>t.id!==e));this.unreadMessages=[...i]}}editMessage(e,t){const s=new CustomEvent("edit-message",{detail:{id:e,text:t}});window.dispatchEvent(s)}editMessageInChat(e){if(!e.payload.message.status.isEdited)return;const t=new CustomEvent("edited-message",{detail:{id:e.payload.message.id,text:e.payload.message.text}});window.dispatchEvent(t)}changeStatusToDelivery(e){if(!e.payload.message.status.isDelivered)return;const t=new CustomEvent("change-status",{detail:{id:e.payload.message.id,status:{isDelivered:!0,isReaded:!1,isEdited:!1}}});window.dispatchEvent(t)}changeStatusToRead(e){if(!e.payload.message.status.isReaded)return;const t=new CustomEvent("change-status",{detail:{id:e.payload.message.id,status:{isDelivered:!0,isReaded:!0,isEdited:!1}}});window.dispatchEvent(t)}};d.start()})();