(()=>{"use strict";var e,t,a={d:(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};a.d({},{y:()=>f});class n{constructor(e){this.element=document.createElement(e.tag),this.createElement(e)}createElement(e){e.classNames.forEach((e=>{var t;return null===(t=this.element)||void 0===t?void 0:t.classList.add(e)})),e.text&&(this.element.textContent=e.text)}getElement(){return this.element}appendElement(e){var t;null===(t=this.element)||void 0===t||t.append(e)}removeElement(){this.element.remove()}}!function(e){e.text="text",e.color="color"}(e||(e={})),function(e){e.garage="garage",e.winners="winners"}(t||(t={}));class r extends n{constructor(){super({tag:"header",classNames:["header"]}),this.prepareHeader()}prepareHeader(){this.createButtons(),this.createTitle()}createTitle(){const e=new n({tag:"h1",classNames:["header__title"],text:"Async-race"}).getElement();this.appendElement(e)}createButtons(){const e=this.createWrapperToButtons(),t=this.createBtnGarage(),a=this.createBtnWinners();null==e||e.append(t,a)}createWrapperToButtons(){const e=new n({tag:"div",classNames:["header__wrapper"]}).getElement();return this.appendElement(e),e}createBtnGarage(){const e=new n({tag:"button",classNames:["btn","btn__header","btn-garage"],text:"Garage"}).getElement();return e.addEventListener("click",(()=>f.render(t.garage))),e}createBtnWinners(){const e=new n({tag:"button",classNames:["btn","btn__header","btn-winners"],text:"Winners"}).getElement();return e.addEventListener("click",(()=>f.render(t.winners))),e}}var i=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}c((n=n.apply(e,t||[])).next())}))};const s="http://127.0.0.1:3000",o=new class{errorCallback(e){if(200!==e.status)throw Error(e.statusText);return e}createCar(e){const t=new Headers;t.append("Content-Type","application/json");const a=JSON.stringify(e);return fetch(`${s}/garage`,{method:"POST",headers:t,body:a}).then((e=>e.json()))}updateCar(e,t){const a=new Headers;a.append("Content-Type","application/json");const n=JSON.stringify(e);return fetch(`${s}/garage/${t}`,{method:"PUT",headers:a,body:n}).then((e=>e.json()))}getCar(e){return fetch(`${s}/garage/${e}`,{method:"Get"}).then((e=>e.json()))}getCars(e,t){return i(this,void 0,void 0,(function*(){return fetch(`${s}/garage?_limit=${t}&_page=${e}`,{method:"GET"}).then((e=>this.errorCallback(e)))}))}getWinners(e,t){return fetch(`${s}/winners?_limit=${t}&_page=${e}`,{method:"GET"})}getAllWinners(){return fetch(`${s}/winners`,{method:"GET"}).then((e=>e.json()))}getWinner(e){return fetch(`${s}/winners/${e}`,{method:"GET"})}deleteCar(e){return fetch(`${s}/garage/${e}`,{method:"DELETE"})}deleteWinner(e){return i(this,void 0,void 0,(function*(){yield fetch(`${s}/winners/${e}`,{method:"DELETE"})}))}startRace(e){return fetch(`${s}/engine/?id=${e}&status=started`,{method:"PATCH"}).then((e=>e.json()))}stopRace(e){return fetch(`${s}/engine/?id=${e}&status=stopped`,{method:"PATCH"})}driveMode(e){return i(this,void 0,void 0,(function*(){const t=yield fetch(`${s}/engine?id=${e}&status=drive`,{method:"PATCH"});return 200===(null==t?void 0:t.status)}))}},c=[{brand:"Mazda",models:["121","2","3","323","323 Combi","323 Coupé","323 F","5","6","6 Combi","626","626 Combi","B-Fighter","B2500","BT","CX-3","CX-5","CX-7","CX-9","Demio","MPV","MX-3","MX-5","MX-6","Premacy","RX-7","RX-8","Xedox 6"]},{brand:"Škoda",models:["Favorit","Felicia","Citigo","Fabia","Fabia Combi","Fabia Sedan","Felicia Combi","Octavia","Octavia Combi","Roomster","Yeti","Rapid","Rapid Spaceback","Superb","Superb Combi"]},{brand:"Ford",models:["Aerostar","B-Max","C-Max","Cortina","Cougar","Edge","Escort","Escort Cabrio","Escort kombi","Explorer","F-150","F-250","Fiesta","Focus","Focus C-Max","Focus CC","Focus kombi","Fusion","Galaxy","Grand C-Max","Ka","Kuga","Maverick","Mondeo","Mondeo Combi","Mustang","Orion","Puma","Ranger","S-Max","Sierra","Street Ka","Tourneo Connect","Tourneo Custom","Transit","Transit","Transit Bus","Transit Connect LWB","Transit Courier","Transit Custom","Transit kombi","Transit Tourneo","Transit Valnik","Transit Van","Transit Van 350","Windstar"]},{brand:"Renault",models:["Captur","Clio","Clio Grandtour","Espace","Express","Fluence","Grand Espace","Grand Modus","Grand Scenic","Kadjar","Kangoo","Kangoo Express","Koleos","Laguna","Laguna Grandtour","Latitude","Mascott","Mégane","Mégane CC","Mégane Combi","Mégane Grandtour","Mégane Coupé","Mégane Scénic","Scénic","Talisman","Talisman Grandtour","Thalia","Twingo","Wind","Zoé"]},{brand:"Volvo",models:["240","340","360","460","850","850 kombi","C30","C70","C70 Cabrio","C70 Coupé","S40","S60","S70","S80","S90","V40","V50","V60","V70","V90","XC60","XC70","XC90"]},{brand:"Fiat",models:["1100","126","500","500L","500X","850","Barchetta","Brava","Cinquecento","Coupé","Croma","Doblo","Doblo Cargo","Doblo Cargo Combi","Ducato","Ducato Van","Ducato Kombi","Ducato Podvozok","Florino","Florino Combi","Freemont","Grande Punto","Idea","Linea","Marea","Marea Weekend","Multipla","Palio Weekend","Panda","Panda Van","Punto","Punto Cabriolet","Punto Evo","Punto Van","Qubo","Scudo","Scudo Van","Scudo Kombi","Sedici","Seicento","Stilo","Stilo Multiwagon","Strada","Talento","Tipo","Ulysse","Uno","X1/9"]},{brand:"Porsche",models:["911 Carrera","911 Carrera Cabrio","911 Targa","911 Turbo","924","944","997","Boxster","Cayenne","Cayman","Macan","Panamera"]},{brand:"Mercedes-Benz",models:["100 D","115","124","126","190","190 D","190 E","200 - 300","200 D","200 E","210 Van","210 kombi","310 Van","310 kombi","230 - 300 CE Coupé","260 - 560 SE","260 - 560 SEL","500 - 600 SEC Coupé","Trieda A","A","A L","AMG GT","Trieda B","Trieda C","C","C Sportcoupé","C T","Citan","CL","CL","CLA","CLC","CLK Cabrio","CLK Coupé","CLS","Trieda E","E","E Cabrio","E Coupé","E T","Trieda G","G Cabrio","GL","GLA","GLC","GLE","GLK","Trieda M","MB 100","Trieda R","Trieda S","S","S Coupé","SL","SLC","SLK","SLR","Sprinter"]},{brand:"Toyota",models:["4-Runner","Auris","Avensis","Avensis Combi","Avensis Van Verso","Aygo","Camry","Carina","Celica","Corolla","Corolla Combi","Corolla sedan","Corolla Verso","FJ Cruiser","GT86","Hiace","Hiace Van","Highlander","Hilux","Land Cruiser","MR2","Paseo","Picnic","Prius","RAV4","Sequoia","Starlet","Supra","Tundra","Urban Cruiser","Verso","Yaris","Yaris Verso"]},{brand:"Seat",models:["Alhambra","Altea","Altea XL","Arosa","Cordoba","Cordoba Vario","Exeo","Ibiza","Ibiza ST","Exeo ST","Leon","Leon ST","Inca","Mii","Toledo"]}];function l(e){return Math.floor(Math.random()*e)}function d(){const e=c[l(c.length)],t=e.models[l(e.models.length)];return e.brand.concat(" ",t)}const g='<svg class=\'garage__car__svg\' width="75px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" transform="rotate(0)matrix(-1, 0, 0, 1, 0, 0)">\n\n<g id="SVGRepo_bgCarrier" stroke-width="0"/>\n\n<g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n\n<g id="SVGRepo_iconCarrier"> <style type="text/css"> </style> <g> <path class="st0" d="M495.144,222.319h-23.666l-57.053-99.424H202.691l-79.664,99.424H25.062 c-15.469,0-27.236,13.815-24.722,29.086l15.072,91.822c0,0.726,0.594,1.388,1.322,1.388h64.387 c3.305-28.757,27.764-51.166,57.379-51.166s54.076,22.409,57.381,51.166H343.43c3.305-28.757,27.766-51.166,57.381-51.166 s54.074,22.409,57.381,51.166h36.953c9.32,0,16.856-7.537,16.856-16.858v-88.583C512,229.855,504.465,222.319,495.144,222.319z M327.894,162.559h57.906l35.898,59.76l1.254,3.709l0.268,0.984h-95.326V162.559z M179.853,226.923l1.879-4.604l47.799-59.76 h53.016v64.454h-74.61L179.853,226.923z"/> <path class="st0" d="M138.5,313.282c-18.707,0-34.242,13.552-37.348,31.334c-0.398,2.114-0.598,4.362-0.598,6.611 c0,20.889,16.99,37.878,37.945,37.878c20.957,0,37.946-16.99,37.946-37.878c0-2.248-0.198-4.496-0.594-6.611 C172.744,326.833,157.209,313.282,138.5,313.282z"/> <path class="st0" d="M400.81,313.282c-18.709,0-34.244,13.552-37.35,31.334c-0.398,2.114-0.596,4.362-0.596,6.611 c0,20.889,16.988,37.878,37.945,37.878c20.955,0,37.944-16.99,37.944-37.878c0-2.248-0.198-4.496-0.594-6.611 C435.053,326.833,419.518,313.282,400.81,313.282z"/> </g> </g>\n\n</svg>';var u=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}c((n=n.apply(e,t||[])).next())}))};class m extends n{constructor(e){super({tag:"div",classNames:["garage__race__row"]}),this.animation=0,this.prepareGarageRow(e),this.id=e.id}prepareGarageRow(e){this.createInfo(e),this.createStartAndStop(e.id),this.createCar(e),this.createFinish()}createCar(e){const t=new n({tag:"div",classNames:["garage__race__row__car"]}).getElement();t.id=String(e.id),t.innerHTML=g,t.style.fill=e.color,this.appendElement(t)}createFinish(){const e=new n({tag:"div",classNames:["garage__race__row__finish"]}).getElement();e.innerHTML='<svg height="50px" width="50px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000" stroke="#000000">\n\n<g id="SVGRepo_bgCarrier" stroke-width="0"/>\n\n<g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n\n<g id="SVGRepo_iconCarrier"> <path style="fill:#E2E2E2;" d="M503.916,51.2v102.4v113.179v102.4c0,5.953-4.826,10.779-10.779,10.779h-102.4H277.558H164.379 H16.707V266.779V153.6V40.421h147.672h113.179h113.179h102.4C499.09,40.421,503.916,45.247,503.916,51.2z"/> <path style="fill:#002E35;" d="M390.737,153.6H277.558V40.421h113.179V153.6z M40.421,40.421V153.6h123.958V40.421H40.421z M390.737,153.6v113.179h113.179V153.6H390.737z M164.379,153.6v113.179h113.179V153.6H164.379z M277.558,379.958h113.179V266.779 H277.558V379.958z M40.421,379.958h123.958V266.779H40.421V379.958z"/> <path style="fill:#BF4D00;" d="M29.642,503.916L29.642,503.916c-11.906,0-21.558-9.651-21.558-21.558V29.642 c0-11.906,9.651-21.558,21.558-21.558l0,0c11.906,0,21.558,9.651,21.558,21.558v452.716C51.2,494.264,41.549,503.916,29.642,503.916 z"/> <path style="fill:#8C1A00;" d="M40.421,501.009c-3.173,1.838-6.848,2.907-10.779,2.907c-11.906,0-21.558-9.651-21.558-21.558V29.642 c0-11.906,9.651-21.558,21.558-21.558c3.931,0,7.606,1.069,10.779,2.907c-6.437,3.73-10.779,10.675-10.779,18.65v452.716 C29.642,490.332,33.984,497.279,40.421,501.009z"/> <path d="M493.137,32.337H59.284v-2.695C59.284,13.298,45.986,0,29.642,0S0,13.298,0,29.642v452.716C0,498.702,13.298,512,29.642,512 s29.642-13.298,29.642-29.642v-94.316h433.853c10.401,0,18.863-8.463,18.863-18.863V51.2C512,40.799,503.537,32.337,493.137,32.337z M43.116,482.358c0,7.43-6.044,13.474-13.474,13.474s-13.474-6.044-13.474-13.474V29.642c0-7.43,6.044-13.474,13.474-13.474 s13.474,6.044,13.474,13.474V482.358z M495.832,369.179c0,1.486-1.208,2.695-2.695,2.695H59.284V48.505h433.853 c1.486,0,2.695,1.208,2.695,2.695V369.179z"/> </g>\n\n</svg>',this.appendElement(e)}createInfo(e){const t=new n({tag:"div",classNames:["garage__race__row__info"]}).getElement(),a=this.createBtnSelect(e.id),r=this.createBtnRemove(e.id),i=new n({tag:"span",classNames:["garage__race__row__info-title"],text:e.name}).getElement();t.append(a,r,i),this.appendElement(t)}createBtnSelect(e){const t=new n({tag:"button",classNames:["btn","btn-select"],text:"Select"}).getElement();return t.dataset.carId=String(e),t.addEventListener("click",(()=>this.selectCar(e))),t}createBtnRemove(e){const t=new n({tag:"button",classNames:["btn","btn-remove"],text:"Remove"}).getElement();return t.dataset.carId=String(e),t.addEventListener("click",(()=>this.removeCar(e))),t}selectCar(e){return u(this,void 0,void 0,(function*(){const t=yield this.getInfoAboutCar(e);this.enableUpdateForm(t,e)}))}enableUpdateForm(e,t){const a=document.getElementById("update_car_title"),n=document.getElementById("update_car_color"),r=document.querySelector(".btn-update");a.disabled=!1,a.value=e.name,n.disabled=!1,n.value=e.color,r.disabled=!1,r.setAttribute("car-id",String(t))}getInfoAboutCar(e){return u(this,void 0,void 0,(function*(){return yield o.getCar(e)}))}removeCar(e){return u(this,void 0,void 0,(function*(){200===(yield o.deleteCar(e)).status&&(yield this.removeCarFromWinners(e),f.pageGarage.removeCarsFromGarage(),f.pageGarage.renderCars(),this.removeElement())}))}removeCarFromWinners(e){return u(this,void 0,void 0,(function*(){-1!==(yield o.getAllWinners()).findIndex((t=>t.id===e))&&(yield o.deleteWinner(e))}))}startAnimation(e,t,a,n,r=0){0===r&&(r=e);const i=+e-+r,s=a.offsetLeft*i/n;i<n&&(t.style.transform=`translateX(${s}px)`,this.animation=requestAnimationFrame((e=>this.startAnimation(e,t,a,n,r))))}createBtnStart(e){const t=new n({tag:"button",classNames:["btn","btn-drive","btn-start"],text:"Start"}).getElement();return t.dataset.carId=String(e),t.addEventListener("click",(()=>this.startRace(e))),t}createBtnStop(e){const t=new n({tag:"button",classNames:["btn","btn-drive","btn-stop"],text:"Stop"}).getElement();return t.dataset.carId=String(e),t.disabled=!0,t.addEventListener("click",(()=>this.stopRaceCar(e))),t}createStartAndStop(e){const t=new n({tag:"div",classNames:["garage__race__row__startAndStop"]}).getElement(),a=this.createBtnStart(e),r=this.createBtnStop(e);t.append(a,r),this.appendElement(t)}startRace(e){return u(this,void 0,void 0,(function*(){const t=yield this.getDurationAnimation(e);this.startRaceCar(t)}))}startRaceCar(e){return u(this,void 0,void 0,(function*(){const t=e.distance/e.velocity,a=document.getElementById(String(this.id)),n=this.element.querySelector(".garage__race__row__finish");this.animation=requestAnimationFrame((e=>this.startAnimation(e,a,n,t))),this.disableBtn(".btn-start"),this.enableBtn(".btn-stop"),(yield o.driveMode(this.id))||cancelAnimationFrame(this.animation)}))}getDurationAnimation(e){return u(this,void 0,void 0,(function*(){return yield o.startRace(e)}))}stopRaceCar(e){return u(this,void 0,void 0,(function*(){200===(yield o.stopRace(e)).status&&(this.disableBtn(".btn-stop"),this.enableBtn(".btn-start"),cancelAnimationFrame(this.animation),this.moveCarToStart(e))}))}disableBtn(e){this.element.querySelector(e).disabled=!0}enableBtn(e){this.element.querySelector(e).disabled=!1}moveCarToStart(e){document.getElementById(String(e)).style.transform=""}}class h extends n{constructor(){super({tag:"div",classNames:["garage__page"]}),this.cars=[]}renderCars(e){e.forEach((e=>this.addCarToPage(e)))}addCarToPage(e){const t=new n({tag:"div",classNames:["garage__race"]}).getElement(),a=new m(e);this.cars.push(a),t.append(a.getElement()),this.appendElement(t)}removeAllCars(){this.getElement().innerHTML=""}startRace(e){e.forEach((e=>{var t;return null===(t=this.cars.find((t=>t.id===e.id)))||void 0===t?void 0:t.startRaceCar(e.car)}))}}var p=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}c((n=n.apply(e,t||[])).next())}))};class C extends n{constructor(){super({tag:"div",classNames:["garage"]}),this.garagePage=new h,this.carsCount=0,this.currentPage=1,this.prepareGarage()}prepareGarage(){this.createTitle(),this.createPageNumber(),this.createGarage()}createTitle(){const e=new n({tag:"h2",classNames:["garage__title"],text:"Garage ( 0 )"}).getElement();this.appendElement(e)}createPageNumber(){const e=new n({tag:"p",classNames:["garage__page"],text:"Page ( 1 )"}).getElement();this.appendElement(e)}createGarage(){this.appendElement(this.garagePage.getElement())}addCarToGarage(e){e.preventDefault();const t=this.getInfoAboutCar("car_color","car_title");this.createCar(t)}createCar(e){return p(this,void 0,void 0,(function*(){this.carsCount+=1,this.updateTitle();const t=yield o.createCar(e);this.carsCount<=7*this.currentPage&&this.garagePage.addCarToPage(t),this.checkNextPage()}))}updateCar(e){return p(this,void 0,void 0,(function*(){e.preventDefault();const t=this.getCarId(e),a=this.getInfoAboutCar("update_car_color","update_car_title");yield o.updateCar(a,t),this.removeAllCarsFromGarage(),this.renderCarsFromGarage(),this.disableUpdateForm()}))}disableUpdateForm(){const e=document.getElementById("update_car_title"),t=document.getElementById("update_car_color"),a=document.querySelector(".btn-update");e.disabled=!0,e.value="",t.disabled=!0,a.disabled=!0,a.removeAttribute("car-id")}getCarId(e){const t=e.target.getAttribute("car-id");return Number(t)}getInfoAboutCar(e,t){return{color:this.getColor(e),name:this.getTitle(t)}}getColor(e){const t=document.getElementById(e);return null==t?void 0:t.value}getTitle(e){const t=document.getElementById(e);let a=t.value;return a||(a=d()),t.value="",a}updateTitle(){const e=this.element.querySelector(".garage__title");e&&(e.textContent=`Garage ( ${this.carsCount} )`)}updatePageNumber(){const e=this.element.querySelector(".garage__page");e&&(e.textContent=`Page ( ${this.currentPage} )`)}removeCarFromGarage(){this.carsCount-=1,this.updateTitle()}renderCarsFromGarage(){return p(this,void 0,void 0,(function*(){const e=yield this.getCarsFromGarage();this.updateTitle(),this.updatePageNumber(),this.checkNextPage(),this.garagePage.renderCars(e)}))}getCarsFromGarage(){return p(this,void 0,void 0,(function*(){try{const e=yield o.getCars(this.currentPage,7),t=e.headers.get("X-Total-Count");return t&&(this.carsCount=parseInt(t)),yield e.json()}catch(e){return[]}}))}removeAllCarsFromGarage(){this.garagePage.removeAllCars()}setEnableStatus(e,t){document.querySelector(e).disabled=t}goToNextPage(){this.currentPage+=1,this.removeAllCarsFromGarage(),this.renderCarsFromGarage(),this.setEnableStatus(".btn-previous",!1)}goToPreviousPage(){this.currentPage-=1,this.removeAllCarsFromGarage(),this.renderCarsFromGarage(),1===this.currentPage&&this.setEnableStatus(".btn-previous",!0)}checkNextPage(){this.carsCount<=7*this.currentPage?this.setEnableStatus(".btn-next",!0):this.setEnableStatus(".btn-next",!1)}generateRandomCars(e){return p(this,void 0,void 0,(function*(){for(let t=1;t<=e;t+=1){const e={name:d(),color:`#${l(256).toString(16).padStart(2,"0")}${l(256).toString(16).padStart(2,"0")}${l(256).toString(16).padStart(2,"0")}`};yield this.createCar(e)}}))}getCurrentPage(){return this.currentPage}getCarsPerPage(){return 7}startRace(e){this.garagePage.startRace(e)}}class _ extends n{constructor(){super({tag:"main",classNames:["main","main__garage"]}),this.garage=new C,this.prepareMain()}prepareMain(){this.createSettings(),this.garage.renderCarsFromGarage(),this.appendElement(this.garage.getElement())}createSettings(){const e=this.createWrapperToField(["main__settings"]),t=this.createFormNewCar(),a=this.createFormUpdateCar(),n=this.createSettingButtons();e.append(t,a,n)}createSettingButtons(){const e=this.createWrapperToField(["main__setting__buttons"]),t=this.createBtn(["btn","btn__setting","btn-race"],"Race");t.addEventListener("click",(()=>this.startRace()));const a=this.createBtn(["btn","btn__setting","btn-reset"],"Reset");a.disabled=!0;const n=this.createBtn(["btn","btn__setting","btn-generate"],"Generate cars");return n.addEventListener("click",(()=>this.garage.generateRandomCars(100))),e.append(t,a,n),e}createFormNewCar(){const t=this.createForm("form__create"),a=this.createInput(["input","input__newCar"],e.text,"car_title"),n=this.createInput(["input","input__newCarColor"],e.color,"car_color"),r=this.createBtn(["btn","btn__main","btn-create"],"Create");return r.addEventListener("click",(e=>this.garage.addCarToGarage(e))),null==t||t.append(a,n,r),t}createFormUpdateCar(){const t=this.createForm("form__update"),a=this.createInput(["input","input__updateCar"],e.text,"update_car_title");a.disabled=!0;const n=this.createInput(["input","input__updateCarColor"],e.color,"update_car_color");n.disabled=!0;const r=this.createBtn(["btn","btn__main","btn-update"],"Update");return r.addEventListener("click",(e=>this.garage.updateCar(e))),r.disabled=!0,null==t||t.append(a,n,r),t}createWrapperToField(e){const t=new n({tag:"div",classNames:e}).getElement();return this.appendElement(t),t}createForm(e){return new n({tag:"form",classNames:["main__form",e]}).getElement()}createInput(t,a,r){const i=new n({tag:"input",classNames:t}).getElement();return i.type=a,i.id=r,a===e.color&&(i.value="#ce63dd"),i}createBtn(e,t){return new n({tag:"button",classNames:e,text:t}).getElement()}getCurrentPage(){return this.garage.getCurrentPage()}getCarsPerPage(){return this.garage.getCarsPerPage()}renderCars(){this.garage.renderCarsFromGarage()}removeCarsFromGarage(){this.garage.removeAllCarsFromGarage()}goToTheNextPage(){this.garage.goToNextPage()}goToThePreviousPage(){this.garage.goToPreviousPage()}disableBtn(e){this.element.querySelector(e).disabled=!0}enableBtn(e){this.element.querySelector(e).disabled=!1}startRace(){return e=this,t=void 0,n=function*(){const e=[...document.querySelectorAll(".btn-start")],t=e.map((e=>Number(e.dataset.carId))).map((e=>o.startRace(e))),a=(yield Promise.all(t)).map(((t,a)=>({id:Number(e[a].dataset.carId),car:t})));this.garage.startRace(a)},new((a=void 0)||(a=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}c((n=n.apply(e,t||[])).next())}));var e,t,a,n}}class v extends n{constructor(){super({tag:"footer",classNames:["footer"]}),this.preparefooter()}preparefooter(){this.createPageButtons()}createPageButtons(){const e=this.createBtn(["btn","btn__main","btn-previous"],"<< Page");e.addEventListener("click",(()=>f.goToThePreviousPage())),e.disabled=!0;const t=this.createBtn(["btn","btn__main","btn-next"],"Page >>");t.addEventListener("click",(()=>f.goToTheNextPage())),t.disabled=!0,this.getElement().append(e,t)}createBtn(e,t){return new n({tag:"button",classNames:e,text:t}).getElement()}}class b{constructor(){this.container=new n({tag:"div",classNames:["container","container__garage"]}).getElement(),this.mainGarage=new _,this.createPage()}createPage(){const e=(new r).getElement(),t=(new v).getElement();this.container.append(e,this.mainGarage.getElement(),t)}getPage(){return this.container}getCurrentPage(){return this.mainGarage.getCurrentPage()}getCarsPerPage(){return this.mainGarage.getCarsPerPage()}renderCars(){this.mainGarage.renderCars()}removeCarsFromGarage(){this.mainGarage.removeCarsFromGarage()}goToTheNextPage(){this.mainGarage.goToTheNextPage()}goToThePreviousPage(){this.mainGarage.goToThePreviousPage()}}var w=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}c((n=n.apply(e,t||[])).next())}))};class E extends n{constructor(){super({tag:"main",classNames:["main","main__winners"]}),this.currentPage=1,this.winnersCount=0,this.prepareMain()}prepareMain(){this.createTitle(),this.createPageNumber()}createPageNumber(){const e=new n({tag:"p",classNames:["winners__page"],text:"Page ( 1 )"}).getElement();this.appendElement(e)}createTitle(){const e=new n({tag:"h2",classNames:["winners__title"],text:"Winners"}).getElement();this.appendElement(e)}createTable(){return new n({tag:"div",classNames:["main__table__winners"]}).getElement()}getWinners(){return w(this,void 0,void 0,(function*(){const e=yield o.getWinners(this.currentPage,10),t=e.headers.get("X-Total-Count");return t&&(this.winnersCount=parseInt(t)),yield e.json()}))}renderWinners(){return w(this,void 0,void 0,(function*(){const e=yield this.getWinners();this.updateTitle();const t=this.createTable();this.createRowToTable(t,["Number","Image","Model","Wins","Best time"]),this.createWinnersTable(t,e),this.element.append(t)}))}updateTitle(){const e=this.element.querySelector(".winners__title");e&&(e.textContent=`Winners ( ${this.winnersCount} )`)}createRowToTable(e,t){const a=new n({tag:"div",classNames:["main__winners__title"]}).getElement();t.forEach((e=>{const t=new n({tag:"span",classNames:["main__winners__title-elem"],text:e}).getElement();a.append(t)})),e.append(a)}createWinnersRow(e,t,a){const r=new n({tag:"div",classNames:["main__winners__row"]}).getElement(),i=new n({tag:"span",classNames:["main__winners__row__item","main__winners__row-number"],text:String(t+1)}).getElement(),s=new n({tag:"span",classNames:["main__winners__row__item","main__winners__row-image"]}).getElement();s.innerHTML=g,s.style.fill=a.color;const o=new n({tag:"span",classNames:["main__winners__row__item","main__winners__row-name"],text:a.name}).getElement(),c=new n({tag:"span",classNames:["main__winners__row__item","main__winners__row-wins"],text:String(a.wins)}).getElement(),l=new n({tag:"span",classNames:["main__winners__row__item","main__winners__row-time"],text:String(a.time)}).getElement();r.append(i,s,o,c,l),e.append(r)}createWinnersTable(e,t){return w(this,void 0,void 0,(function*(){const a=yield t;for(let t=0;t<a.length;t+=1){const n=yield o.getCar(a[t].id);this.createWinnersRow(e,t,{name:n.name,color:n.color,wins:a[t].wins,time:a[t].time})}}))}removeWinners(){const e=document.querySelector(".main__table__winners");e&&this.element.removeChild(e)}}class T{constructor(){this.container=new n({tag:"div",classNames:["container","container__winners"]}).getElement(),this.mainWinners=new E,this.createPage()}createPage(){const e=(new r).getElement(),t=(new v).getElement();this.container.append(e,this.mainWinners.getElement(),t)}renderWinners(){this.mainWinners.renderWinners()}getPage(){return this.renderWinners(),this.container}removeWinners(){this.mainWinners.removeWinners()}}const f=new class{constructor(){this.pageGarage=new b,this.pageWinners=new T,this.view=t.garage}renderPage(e){document.body.innerHTML="",document.body.append(e.getPage())}render(e){if(e===t.winners)return this.view=t.winners,void this.renderPage(this.pageWinners);this.view=t.garage,this.pageWinners.removeWinners(),this.renderPage(this.pageGarage)}goToTheNextPage(){this.view!==t.garage||this.pageGarage.mainGarage.goToTheNextPage()}goToThePreviousPage(){this.view!==t.garage||this.pageGarage.mainGarage.goToThePreviousPage()}};f.render(t.garage)})();