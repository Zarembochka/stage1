(()=>{"use strict";var e,t,n={d:(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};n.d({},{y:()=>y});class a{constructor(e){this.element=document.createElement(e.tag),this.createElement(e)}createElement(e){e.classNames.forEach((e=>{var t;return null===(t=this.element)||void 0===t?void 0:t.classList.add(e)})),e.text&&(this.element.textContent=e.text)}getElement(){return this.element}appendElement(e){var t;null===(t=this.element)||void 0===t||t.append(e)}removeElement(){this.element.remove()}}!function(e){e.text="text",e.color="color"}(e||(e={})),function(e){e.garage="garage",e.winners="winners"}(t||(t={}));class r extends a{constructor(){super({tag:"header",classNames:["header"]}),this.prepareHeader()}prepareHeader(){this.createButtons(),this.createTitle()}createTitle(){const e=new a({tag:"h1",classNames:["header__title"],text:"Async-race"}).getElement();this.appendElement(e)}createButtons(){const e=this.createWrapperToButtons(),t=this.createBtnGarage(),n=this.createBtnWinners();null==e||e.append(t,n)}createWrapperToButtons(){const e=new a({tag:"div",classNames:["header__wrapper"]}).getElement();return this.appendElement(e),e}createBtnGarage(){const e=new a({tag:"button",classNames:["btn","btn__header","btn-garage"],text:"Garage"}).getElement();return e.addEventListener("click",(()=>y.render(t.garage))),e}createBtnWinners(){const e=new a({tag:"button",classNames:["btn","btn__header","btn-winners"],text:"Winners"}).getElement();return e.addEventListener("click",(()=>y.render(t.winners))),e}}var i=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};const s="http://127.0.0.1:3000",o=new class{errorCallback(e){if(200!==e.status)throw Error(e.statusText);return e}createCar(e){const t=new Headers;t.append("Content-Type","application/json");const n=JSON.stringify(e);return fetch(`${s}/garage`,{method:"POST",headers:t,body:n}).then((e=>e.json()))}updateCar(e,t){const n=new Headers;n.append("Content-Type","application/json");const a=JSON.stringify(e);return fetch(`${s}/garage/${t}`,{method:"PUT",headers:n,body:a}).then((e=>e.json()))}getCar(e){return fetch(`${s}/garage/${e}`,{method:"Get"}).then((e=>e.json()))}getCars(e,t){return i(this,void 0,void 0,(function*(){return fetch(`${s}/garage?_limit=${t}&_page=${e}`,{method:"GET"}).then((e=>this.errorCallback(e)))}))}getWinners(e,t){return fetch(`${s}/winners?_limit=${t}&_page=${e}`,{method:"GET"})}getAllWinners(){return fetch(`${s}/winners`,{method:"GET"}).then((e=>e.json()))}getWinner(e){return fetch(`${s}/winners/${e}`,{method:"GET"})}deleteCar(e){return fetch(`${s}/garage/${e}`,{method:"DELETE"})}deleteWinner(e){return i(this,void 0,void 0,(function*(){yield fetch(`${s}/winners/${e}`,{method:"DELETE"})}))}startRace(e){return fetch(`${s}/engine/?id=${e}&status=started`,{method:"PATCH"}).then((e=>e.json()))}stopRace(e){return fetch(`${s}/engine/?id=${e}&status=stopped`,{method:"PATCH"})}driveMode(e){return i(this,void 0,void 0,(function*(){const t=yield fetch(`${s}/engine?id=${e}&status=drive`,{method:"PATCH"}).then((e=>this.errorCallback(e))).catch((e=>console.log(e)));return 200===(null==t?void 0:t.status)}))}createWinner(e){return i(this,void 0,void 0,(function*(){const t=new Headers;t.append("Content-Type","application/json");const n=JSON.stringify(e);return fetch(`${s}/winners`,{method:"POST",headers:t,body:n})}))}updateWinner(e){return i(this,void 0,void 0,(function*(){const t=new Headers;t.append("Content-Type","application/json");const n={method:"PUT",headers:t,body:JSON.stringify(e)};return fetch(`${s}/winners/${e.id}`,n)}))}},c=[{brand:"Mazda",models:["121","2","3","323","323 Combi","323 Coupé","323 F","5","6","6 Combi","626","626 Combi","B-Fighter","B2500","BT","CX-3","CX-5","CX-7","CX-9","Demio","MPV","MX-3","MX-5","MX-6","Premacy","RX-7","RX-8","Xedox 6"]},{brand:"Škoda",models:["Favorit","Felicia","Citigo","Fabia","Fabia Combi","Fabia Sedan","Felicia Combi","Octavia","Octavia Combi","Roomster","Yeti","Rapid","Rapid Spaceback","Superb","Superb Combi"]},{brand:"Ford",models:["Aerostar","B-Max","C-Max","Cortina","Cougar","Edge","Escort","Escort Cabrio","Escort kombi","Explorer","F-150","F-250","Fiesta","Focus","Focus C-Max","Focus CC","Focus kombi","Fusion","Galaxy","Grand C-Max","Ka","Kuga","Maverick","Mondeo","Mondeo Combi","Mustang","Orion","Puma","Ranger","S-Max","Sierra","Street Ka","Tourneo Connect","Tourneo Custom","Transit","Transit","Transit Bus","Transit Connect LWB","Transit Courier","Transit Custom","Transit kombi","Transit Tourneo","Transit Valnik","Transit Van","Transit Van 350","Windstar"]},{brand:"Renault",models:["Captur","Clio","Clio Grandtour","Espace","Express","Fluence","Grand Espace","Grand Modus","Grand Scenic","Kadjar","Kangoo","Kangoo Express","Koleos","Laguna","Laguna Grandtour","Latitude","Mascott","Mégane","Mégane CC","Mégane Combi","Mégane Grandtour","Mégane Coupé","Mégane Scénic","Scénic","Talisman","Talisman Grandtour","Thalia","Twingo","Wind","Zoé"]},{brand:"Volvo",models:["240","340","360","460","850","850 kombi","C30","C70","C70 Cabrio","C70 Coupé","S40","S60","S70","S80","S90","V40","V50","V60","V70","V90","XC60","XC70","XC90"]},{brand:"Fiat",models:["1100","126","500","500L","500X","850","Barchetta","Brava","Cinquecento","Coupé","Croma","Doblo","Doblo Cargo","Doblo Cargo Combi","Ducato","Ducato Van","Ducato Kombi","Ducato Podvozok","Florino","Florino Combi","Freemont","Grande Punto","Idea","Linea","Marea","Marea Weekend","Multipla","Palio Weekend","Panda","Panda Van","Punto","Punto Cabriolet","Punto Evo","Punto Van","Qubo","Scudo","Scudo Van","Scudo Kombi","Sedici","Seicento","Stilo","Stilo Multiwagon","Strada","Talento","Tipo","Ulysse","Uno","X1/9"]},{brand:"Porsche",models:["911 Carrera","911 Carrera Cabrio","911 Targa","911 Turbo","924","944","997","Boxster","Cayenne","Cayman","Macan","Panamera"]},{brand:"Mercedes-Benz",models:["100 D","115","124","126","190","190 D","190 E","200 - 300","200 D","200 E","210 Van","210 kombi","310 Van","310 kombi","230 - 300 CE Coupé","260 - 560 SE","260 - 560 SEL","500 - 600 SEC Coupé","Trieda A","A","A L","AMG GT","Trieda B","Trieda C","C","C Sportcoupé","C T","Citan","CL","CL","CLA","CLC","CLK Cabrio","CLK Coupé","CLS","Trieda E","E","E Cabrio","E Coupé","E T","Trieda G","G Cabrio","GL","GLA","GLC","GLE","GLK","Trieda M","MB 100","Trieda R","Trieda S","S","S Coupé","SL","SLC","SLK","SLR","Sprinter"]},{brand:"Toyota",models:["4-Runner","Auris","Avensis","Avensis Combi","Avensis Van Verso","Aygo","Camry","Carina","Celica","Corolla","Corolla Combi","Corolla sedan","Corolla Verso","FJ Cruiser","GT86","Hiace","Hiace Van","Highlander","Hilux","Land Cruiser","MR2","Paseo","Picnic","Prius","RAV4","Sequoia","Starlet","Supra","Tundra","Urban Cruiser","Verso","Yaris","Yaris Verso"]},{brand:"Seat",models:["Alhambra","Altea","Altea XL","Arosa","Cordoba","Cordoba Vario","Exeo","Ibiza","Ibiza ST","Exeo ST","Leon","Leon ST","Inca","Mii","Toledo"]}];function d(e){return Math.floor(Math.random()*e)}function l(){const e=c[d(c.length)],t=e.models[d(e.models.length)];return e.brand.concat(" ",t)}const g=new class extends a{constructor(){super({tag:"div",classNames:["modal"]}),this.title=new a({tag:"h3",classNames:["modal__title"],text:"The winner is:"}).getElement(),this.winner=new a({tag:"h4",classNames:["modal__title"]}).getElement(),this.prepareModal()}prepareModal(){this.getElement().append(this.title,this.winner)}addWinner(e,t){this.winner.textContent=`${e} with time ${t.toString()}`,this.appendElement(this.winner)}showModal(e,t){this.addWinner(e,t),this.addModalToDOM(),setTimeout((()=>this.hideModal()),3500)}hideModal(){this.getElement().remove()}addModalToDOM(){document.body.append(this.getElement())}},h='<svg class=\'garage__car__svg\' width="75px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" transform="rotate(0)matrix(-1, 0, 0, 1, 0, 0)">\n\n<g id="SVGRepo_bgCarrier" stroke-width="0"/>\n\n<g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n\n<g id="SVGRepo_iconCarrier"> <style type="text/css"> </style> <g> <path class="st0" d="M495.144,222.319h-23.666l-57.053-99.424H202.691l-79.664,99.424H25.062 c-15.469,0-27.236,13.815-24.722,29.086l15.072,91.822c0,0.726,0.594,1.388,1.322,1.388h64.387 c3.305-28.757,27.764-51.166,57.379-51.166s54.076,22.409,57.381,51.166H343.43c3.305-28.757,27.766-51.166,57.381-51.166 s54.074,22.409,57.381,51.166h36.953c9.32,0,16.856-7.537,16.856-16.858v-88.583C512,229.855,504.465,222.319,495.144,222.319z M327.894,162.559h57.906l35.898,59.76l1.254,3.709l0.268,0.984h-95.326V162.559z M179.853,226.923l1.879-4.604l47.799-59.76 h53.016v64.454h-74.61L179.853,226.923z"/> <path class="st0" d="M138.5,313.282c-18.707,0-34.242,13.552-37.348,31.334c-0.398,2.114-0.598,4.362-0.598,6.611 c0,20.889,16.99,37.878,37.945,37.878c20.957,0,37.946-16.99,37.946-37.878c0-2.248-0.198-4.496-0.594-6.611 C172.744,326.833,157.209,313.282,138.5,313.282z"/> <path class="st0" d="M400.81,313.282c-18.709,0-34.244,13.552-37.35,31.334c-0.398,2.114-0.596,4.362-0.596,6.611 c0,20.889,16.988,37.878,37.945,37.878c20.955,0,37.944-16.99,37.944-37.878c0-2.248-0.198-4.496-0.594-6.611 C435.053,326.833,419.518,313.282,400.81,313.282z"/> </g> </g>\n\n</svg>';var u=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};class m extends a{constructor(e,t){super({tag:"div",classNames:["garage__race__row"]}),this.animation=0,this.car=e,this.prepareGarageRow(e),this.page=t,this.time=0}prepareGarageRow(e){this.createInfo(e),this.createStartAndStop(),this.createCar(e),this.createFinish()}createCar(e){const t=new a({tag:"div",classNames:["garage__race__row__car"]}).getElement();t.id=String(e.id),t.innerHTML=h,t.style.fill=e.color,this.appendElement(t)}createFinish(){const e=new a({tag:"div",classNames:["garage__race__row__finish"]}).getElement();e.innerHTML='<svg height="50px" width="50px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000" stroke="#000000">\n\n<g id="SVGRepo_bgCarrier" stroke-width="0"/>\n\n<g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n\n<g id="SVGRepo_iconCarrier"> <path style="fill:#E2E2E2;" d="M503.916,51.2v102.4v113.179v102.4c0,5.953-4.826,10.779-10.779,10.779h-102.4H277.558H164.379 H16.707V266.779V153.6V40.421h147.672h113.179h113.179h102.4C499.09,40.421,503.916,45.247,503.916,51.2z"/> <path style="fill:#002E35;" d="M390.737,153.6H277.558V40.421h113.179V153.6z M40.421,40.421V153.6h123.958V40.421H40.421z M390.737,153.6v113.179h113.179V153.6H390.737z M164.379,153.6v113.179h113.179V153.6H164.379z M277.558,379.958h113.179V266.779 H277.558V379.958z M40.421,379.958h123.958V266.779H40.421V379.958z"/> <path style="fill:#BF4D00;" d="M29.642,503.916L29.642,503.916c-11.906,0-21.558-9.651-21.558-21.558V29.642 c0-11.906,9.651-21.558,21.558-21.558l0,0c11.906,0,21.558,9.651,21.558,21.558v452.716C51.2,494.264,41.549,503.916,29.642,503.916 z"/> <path style="fill:#8C1A00;" d="M40.421,501.009c-3.173,1.838-6.848,2.907-10.779,2.907c-11.906,0-21.558-9.651-21.558-21.558V29.642 c0-11.906,9.651-21.558,21.558-21.558c3.931,0,7.606,1.069,10.779,2.907c-6.437,3.73-10.779,10.675-10.779,18.65v452.716 C29.642,490.332,33.984,497.279,40.421,501.009z"/> <path d="M493.137,32.337H59.284v-2.695C59.284,13.298,45.986,0,29.642,0S0,13.298,0,29.642v452.716C0,498.702,13.298,512,29.642,512 s29.642-13.298,29.642-29.642v-94.316h433.853c10.401,0,18.863-8.463,18.863-18.863V51.2C512,40.799,503.537,32.337,493.137,32.337z M43.116,482.358c0,7.43-6.044,13.474-13.474,13.474s-13.474-6.044-13.474-13.474V29.642c0-7.43,6.044-13.474,13.474-13.474 s13.474,6.044,13.474,13.474V482.358z M495.832,369.179c0,1.486-1.208,2.695-2.695,2.695H59.284V48.505h433.853 c1.486,0,2.695,1.208,2.695,2.695V369.179z"/> </g>\n\n</svg>',this.appendElement(e)}createInfo(e){const t=new a({tag:"div",classNames:["garage__race__row__info"]}).getElement(),n=this.createBtnSelect(),r=this.createBtnRemove(),i=new a({tag:"span",classNames:["garage__race__row__info-title"],text:e.name}).getElement();t.append(n,r,i),this.appendElement(t)}createBtnSelect(){const e=new a({tag:"button",classNames:["btn","btn-select"],text:"Select"}).getElement();return e.dataset.carId=String(this.car.id),e.addEventListener("click",(()=>this.selectCar())),e}createBtnRemove(){const e=new a({tag:"button",classNames:["btn","btn-remove"],text:"Remove"}).getElement();return e.dataset.carId=String(this.car.id),e.addEventListener("click",(()=>this.removeCar())),e}selectCar(){return u(this,void 0,void 0,(function*(){const e=yield this.getInfoAboutCar();this.enableUpdateForm(e)}))}enableUpdateForm(e){const t=document.getElementById("update_car_title"),n=document.getElementById("update_car_color"),a=document.querySelector(".btn-update");t.disabled=!1,t.value=e.name,n.disabled=!1,n.value=e.color,a.disabled=!1,a.setAttribute("car-id",String(this.car.id))}getInfoAboutCar(){return u(this,void 0,void 0,(function*(){return yield o.getCar(this.car.id)}))}removeCar(){return u(this,void 0,void 0,(function*(){200===(yield o.deleteCar(this.car.id)).status&&(yield this.removeCarFromWinners(),y.pageGarage.removeCarsFromGarage(),y.pageGarage.renderCars(),this.removeElement())}))}removeCarFromWinners(){return u(this,void 0,void 0,(function*(){var e;const t=yield null===(e=this.page)||void 0===e?void 0:e.getWinners();t&&-1!==t.findIndex((e=>e.id===this.car.id))&&(yield o.deleteWinner(this.car.id))}))}startAnimation(e,t,n,a,r=0){0===r&&(r=e);const i=+e-+r,s=n.offsetLeft*i/a;i<a&&(t.style.transform=`translateX(${s}px)`,this.animation=requestAnimationFrame((e=>this.startAnimation(e,t,n,a,r))))}createBtnStart(){const e=new a({tag:"button",classNames:["btn","btn-drive","btn-start"],text:"Start"}).getElement();return e.dataset.carId=String(this.car.id),e.addEventListener("click",(()=>this.startIndividualRace(!1))),e}createBtnStop(){const e=new a({tag:"button",classNames:["btn","btn-drive","btn-stop"],text:"Stop"}).getElement();return e.dataset.carId=String(this.car.id),e.disabled=!0,e.addEventListener("click",(()=>this.stopRaceCar())),e}createStartAndStop(){const e=new a({tag:"div",classNames:["garage__race__row__startAndStop"]}).getElement(),t=this.createBtnStart(),n=this.createBtnStop();e.append(t,n),this.appendElement(e)}startIndividualRace(e){return u(this,void 0,void 0,(function*(){const t=yield this.getDurationAnimation(this.car.id);this.startRaceCar(t,e)}))}checkEngine(e){return u(this,void 0,void 0,(function*(){return o.driveMode(this.car.id).then((t=>t?(e&&this.checkWinner(),!0):(cancelAnimationFrame(this.animation),!1)))}))}checkWinner(){var e,t;(null===(e=this.page)||void 0===e?void 0:e.isWinner())||null===(t=this.page)||void 0===t||t.setWinner(this.car,this.time)}startRaceCar(e,t){return u(this,void 0,void 0,(function*(){const n=e.distance/e.velocity;this.time=n;const a=document.getElementById(String(this.car.id)),r=this.element.querySelector(".garage__race__row__finish");return this.animation=requestAnimationFrame((e=>this.startAnimation(e,a,r,n))),this.disableBtn(".btn-start"),this.enableBtn(".btn-stop"),yield this.checkEngine(t).then((e=>e))}))}getDurationAnimation(e){return u(this,void 0,void 0,(function*(){return yield o.startRace(e)}))}stopRaceCar(){return u(this,void 0,void 0,(function*(){200===(yield o.stopRace(this.car.id).catch()).status&&(this.time=0,this.resetRace())}))}resetRace(){this.disableBtn(".btn-stop"),this.enableBtn(".btn-start"),cancelAnimationFrame(this.animation),this.moveCarToStart(this.car.id)}disableBtn(e){this.element.querySelector(e).disabled=!0}enableBtn(e){this.element.querySelector(e).disabled=!1}moveCarToStart(e){document.getElementById(String(e)).style.transform=""}}var p=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};class v extends a{constructor(){super({tag:"div",classNames:["garage__page"]}),this.cars=[],this.winner=null}renderCars(e){e.forEach((e=>this.addCarToPage(e)))}addCarToPage(e){const t=new a({tag:"div",classNames:["garage__race"]}).getElement(),n=new m(e,this);this.cars.push(n),t.append(n.getElement()),this.appendElement(t)}removeAllCars(){this.cars=[],this.getElement().innerHTML=""}startRace(e){return p(this,void 0,void 0,(function*(){yield Promise.allSettled(e.map((e=>{var t;return null===(t=this.cars.find((t=>t.car.id===e.id)))||void 0===t?void 0:t.startRaceCar(e.car,!0)}))).finally((()=>this.enableResetBtn()))}))}resetRace(e){return p(this,void 0,void 0,(function*(){var t;null===(t=this.cars.find((t=>t.car.id===e)))||void 0===t||t.resetRace()}))}isWinner(){return!!this.winner}setWinner(e,t){this.winner=e;const n=this.timeToSeconds(t);this.showWinner(e.name,n),this.addWinner(e,n)}showWinner(e,t){g.showModal(e,t)}removeWinner(){this.winner=null}addWinner(e,t){return p(this,void 0,void 0,(function*(){const n=yield this.getWinners();if(!n)return;const a=n.find((t=>t.id===e.id));a?o.updateWinner({id:e.id,wins:a.wins+1,time:Math.min(t,a.time)}):o.createWinner({id:e.id,wins:1,time:t}).finally((()=>this.enableResetBtn()))}))}enableResetBtn(){y.pageGarage.mainGarage.enableBtn(".btn-reset")}getWinners(){return p(this,void 0,void 0,(function*(){return yield o.getAllWinners()}))}timeToSeconds(e){return+(e/1e3).toFixed(2)}}var C=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};class b extends a{constructor(){super({tag:"div",classNames:["garage"]}),this.garagePage=new v,this.carsCount=0,this.currentPage=1,this.prepareGarage()}prepareGarage(){this.createTitle(),this.createPageNumber(),this.createGarage()}createTitle(){const e=new a({tag:"h2",classNames:["garage__title"],text:"Garage ( 0 )"}).getElement();this.appendElement(e)}createPageNumber(){const e=new a({tag:"p",classNames:["garage__page"],text:"Page ( 1 )"}).getElement();this.appendElement(e)}createGarage(){this.appendElement(this.garagePage.getElement())}addCarToGarage(e){e.preventDefault();const t=this.getInfoAboutCar("car_color","car_title");this.createCar(t)}createCar(e){return C(this,void 0,void 0,(function*(){this.carsCount+=1,this.updateTitle();const t=yield o.createCar(e);this.carsCount<=7*this.currentPage&&this.garagePage.addCarToPage(t),this.checkNextPage()}))}updateCar(e){return C(this,void 0,void 0,(function*(){e.preventDefault();const t=this.getCarId(e),n=this.getInfoAboutCar("update_car_color","update_car_title");yield o.updateCar(n,t),this.removeAllCarsFromGarage(),this.renderCarsFromGarage(),this.disableUpdateForm()}))}disableUpdateForm(){const e=document.getElementById("update_car_title"),t=document.getElementById("update_car_color"),n=document.querySelector(".btn-update");e.disabled=!0,e.value="",t.disabled=!0,n.disabled=!0,n.removeAttribute("car-id")}getCarId(e){const t=e.target.getAttribute("car-id");return Number(t)}getInfoAboutCar(e,t){return{color:this.getColor(e),name:this.getTitle(t)}}getColor(e){const t=document.getElementById(e);return null==t?void 0:t.value}getTitle(e){const t=document.getElementById(e);let n=t.value;return n||(n=l()),t.value="",n}updateTitle(){const e=this.element.querySelector(".garage__title");e&&(e.textContent=`Garage ( ${this.carsCount} )`)}updatePageNumber(){const e=this.element.querySelector(".garage__page");e&&(e.textContent=`Page ( ${this.currentPage} )`)}removeCarFromGarage(){this.carsCount-=1,this.updateTitle()}renderCarsFromGarage(){return C(this,void 0,void 0,(function*(){const e=yield this.getCarsFromGarage();this.updateTitle(),this.updatePageNumber(),this.checkNextPage(),this.garagePage.renderCars(e)}))}getCarsFromGarage(){return C(this,void 0,void 0,(function*(){try{const e=yield o.getCars(this.currentPage,7),t=e.headers.get("X-Total-Count");return t&&(this.carsCount=parseInt(t)),yield e.json()}catch(e){return[]}}))}removeAllCarsFromGarage(){this.garagePage.removeAllCars()}setEnableStatus(e,t){document.querySelector(e).disabled=t}goToNextPage(){this.currentPage+=1,this.removeAllCarsFromGarage(),this.renderCarsFromGarage(),this.setEnableStatus(".btn-previous",!1)}goToPreviousPage(){this.currentPage-=1,this.removeAllCarsFromGarage(),this.renderCarsFromGarage(),1===this.currentPage&&this.setEnableStatus(".btn-previous",!0)}checkNextPage(){this.carsCount<=7*this.currentPage?this.setEnableStatus(".btn-next",!0):this.setEnableStatus(".btn-next",!1)}generateRandomCars(e){return C(this,void 0,void 0,(function*(){for(let t=1;t<=e;t+=1){const e={name:l(),color:`#${d(256).toString(16).padStart(2,"0")}${d(256).toString(16).padStart(2,"0")}${d(256).toString(16).padStart(2,"0")}`};yield this.createCar(e)}}))}getCurrentPage(){return this.currentPage}getCarsPerPage(){return 7}startRace(e){this.garagePage.startRace(e)}resetRace(e){this.garagePage.resetRace(e)}removeWinner(){this.garagePage.removeWinner()}}var _=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};class w extends a{constructor(){super({tag:"main",classNames:["main","main__garage"]}),this.garage=new b,this.prepareMain()}prepareMain(){this.createSettings(),this.garage.renderCarsFromGarage(),this.appendElement(this.garage.getElement())}createSettings(){const e=this.createWrapperToField(["main__settings"]),t=this.createFormNewCar(),n=this.createFormUpdateCar(),a=this.createSettingButtons();e.append(t,n,a)}createSettingButtons(){const e=this.createWrapperToField(["main__setting__buttons"]),t=this.createBtn(["btn","btn__setting","btn-race"],"Race");t.addEventListener("click",(()=>this.startRace()));const n=this.createBtn(["btn","btn__setting","btn-reset"],"Reset");n.addEventListener("click",(()=>this.resetRace())),n.disabled=!0;const a=this.createBtn(["btn","btn__setting","btn-generate"],"Generate cars");return a.addEventListener("click",(()=>this.garage.generateRandomCars(100))),e.append(t,n,a),e}createFormNewCar(){const t=this.createForm("form__create"),n=this.createInput(["input","input__newCar"],e.text,"car_title"),a=this.createInput(["input","input__newCarColor"],e.color,"car_color"),r=this.createBtn(["btn","btn__main","btn-create"],"Create");return r.addEventListener("click",(e=>this.garage.addCarToGarage(e))),null==t||t.append(n,a,r),t}createFormUpdateCar(){const t=this.createForm("form__update"),n=this.createInput(["input","input__updateCar"],e.text,"update_car_title");n.disabled=!0;const a=this.createInput(["input","input__updateCarColor"],e.color,"update_car_color");a.disabled=!0;const r=this.createBtn(["btn","btn__main","btn-update"],"Update");return r.addEventListener("click",(e=>this.garage.updateCar(e))),r.disabled=!0,null==t||t.append(n,a,r),t}createWrapperToField(e){const t=new a({tag:"div",classNames:e}).getElement();return this.appendElement(t),t}createForm(e){return new a({tag:"form",classNames:["main__form",e]}).getElement()}createInput(t,n,r){const i=new a({tag:"input",classNames:t}).getElement();return i.type=n,i.id=r,n===e.color&&(i.value="#ce63dd"),i}createBtn(e,t){return new a({tag:"button",classNames:e,text:t}).getElement()}getCurrentPage(){return this.garage.getCurrentPage()}getCarsPerPage(){return this.garage.getCarsPerPage()}renderCars(){this.garage.renderCarsFromGarage()}removeCarsFromGarage(){this.garage.removeAllCarsFromGarage()}goToTheNextPage(){this.garage.goToNextPage()}goToThePreviousPage(){this.garage.goToPreviousPage()}disableBtn(e){this.element.querySelector(e).disabled=!0}enableBtn(e){this.element.querySelector(e).disabled=!1}startRace(){return _(this,void 0,void 0,(function*(){y.pageGarage.disableBtn(".btn-winners"),this.disableBtn(".btn-race");const e=[...document.querySelectorAll(".btn-start")],t=e.map((e=>Number(e.dataset.carId))).map((e=>o.startRace(e))),n=(yield Promise.all(t)).map(((t,n)=>({id:Number(e[n].dataset.carId),car:t})));this.garage.startRace(n)}))}resetRace(){return _(this,void 0,void 0,(function*(){this.disableBtn(".btn-reset"),this.enableBtn(".btn-race");const e=[...document.querySelectorAll(".btn-stop")].map((e=>Number(e.dataset.carId))).map((e=>({id:e,car:o.stopRace(e)})));yield Promise.allSettled(e.map((e=>e.car.then((t=>{200===t.status&&this.garage.resetRace(e.id)}))))).finally((()=>{this.garage.removeWinner(),y.pageGarage.enableBtn(".btn-winners")}))}))}}class E extends a{constructor(){super({tag:"footer",classNames:["footer"]}),this.preparefooter()}preparefooter(){this.createPageButtons()}createPageButtons(){const e=this.createBtn(["btn","btn__main","btn-previous"],"<< Page");e.addEventListener("click",(()=>y.goToThePreviousPage())),e.disabled=!0;const t=this.createBtn(["btn","btn__main","btn-next"],"Page >>");t.addEventListener("click",(()=>y.goToTheNextPage())),t.disabled=!0,this.getElement().append(e,t)}createBtn(e,t){return new a({tag:"button",classNames:e,text:t}).getElement()}}class f{constructor(){this.container=new a({tag:"div",classNames:["container","container__garage"]}).getElement(),this.mainGarage=new w,this.createPage()}createPage(){const e=(new r).getElement(),t=(new E).getElement();this.container.append(e,this.mainGarage.getElement(),t)}getPage(){return this.container}getCurrentPage(){return this.mainGarage.getCurrentPage()}getCarsPerPage(){return this.mainGarage.getCarsPerPage()}renderCars(){this.mainGarage.renderCars()}removeCarsFromGarage(){this.mainGarage.removeCarsFromGarage()}goToTheNextPage(){this.mainGarage.goToTheNextPage()}goToThePreviousPage(){this.mainGarage.goToThePreviousPage()}disableBtn(e){document.querySelector(e).disabled=!0}enableBtn(e){document.querySelector(e).disabled=!1}}var T=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};class P extends a{constructor(){super({tag:"main",classNames:["main","main__winners"]}),this.currentPage=1,this.winnersCount=0,this.prepareMain()}prepareMain(){this.createTitle(),this.createPageNumber()}createPageNumber(){const e=new a({tag:"p",classNames:["winners__page"],text:"Page ( 1 )"}).getElement();this.appendElement(e)}createTitle(){const e=new a({tag:"h2",classNames:["winners__title"],text:"Winners"}).getElement();this.appendElement(e)}createTable(){return new a({tag:"div",classNames:["main__table__winners"]}).getElement()}getWinners(){return T(this,void 0,void 0,(function*(){const e=yield o.getWinners(this.currentPage,10),t=e.headers.get("X-Total-Count");return t&&(this.winnersCount=parseInt(t)),yield e.json()}))}renderWinners(){return T(this,void 0,void 0,(function*(){const e=yield this.getWinners();this.updateTitle();const t=this.createTable();this.createRowToTable(t,["Number","Image","Model","Wins","Best time"]),this.createWinnersTable(t,e),this.element.append(t),this.checkNextPage()}))}updateTitle(){const e=this.element.querySelector(".winners__title");e&&(e.textContent=`Winners ( ${this.winnersCount} )`)}createRowToTable(e,t){const n=new a({tag:"div",classNames:["main__winners__title"]}).getElement();t.forEach((e=>{const t=new a({tag:"span",classNames:["main__winners__title-elem"],text:e}).getElement();n.append(t)})),e.append(n)}createWinnersRow(e,t,n){const r=new a({tag:"div",classNames:["main__winners__row"]}).getElement(),i=new a({tag:"span",classNames:["main__winners__row__item","main__winners__row-number"],text:String(t+1)}).getElement(),s=new a({tag:"span",classNames:["main__winners__row__item","main__winners__row-image"]}).getElement();s.innerHTML=h,s.style.fill=n.color;const o=new a({tag:"span",classNames:["main__winners__row__item","main__winners__row-name"],text:n.name}).getElement(),c=new a({tag:"span",classNames:["main__winners__row__item","main__winners__row-wins"],text:String(n.wins)}).getElement(),d=new a({tag:"span",classNames:["main__winners__row__item","main__winners__row-time"],text:String(n.time)}).getElement();r.append(i,s,o,c,d),e.append(r)}createWinnersTable(e,t){return T(this,void 0,void 0,(function*(){const n=yield t;for(let t=0;t<n.length;t+=1){const a=yield o.getCar(n[t].id);this.createWinnersRow(e,t,{name:a.name,color:a.color,wins:n[t].wins,time:n[t].time})}}))}removeWinners(){const e=this.element.querySelector(".main__table__winners");e&&this.element.removeChild(e)}checkNextPage(){this.winnersCount<=10*this.currentPage?this.setEnableStatus(".btn-next",!0):this.setEnableStatus(".btn-next",!1)}setEnableStatus(e,t){document.querySelector(e).disabled=t}goToNextPage(){this.currentPage+=1,this.removeWinners(),this.renderWinners(),this.setEnableStatus(".btn-previous",!1)}goToPreviousPage(){this.currentPage-=1,this.removeWinners(),this.renderWinners(),1===this.currentPage&&this.setEnableStatus(".btn-previous",!0)}}class S{constructor(){this.container=new a({tag:"div",classNames:["container","container__winners"]}).getElement(),this.mainWinners=new P,this.createPage()}createPage(){const e=(new r).getElement(),t=(new E).getElement();this.container.append(e,this.mainWinners.getElement(),t)}renderWinners(){this.mainWinners.renderWinners()}getPage(){return this.removeWinners(),this.renderWinners(),this.container}removeWinners(){this.mainWinners.removeWinners()}}const y=new class{constructor(){this.pageGarage=new f,this.pageWinners=new S,this.view=t.garage}renderPage(e){document.body.innerHTML="",document.body.append(e.getPage())}render(e){if(e===t.winners)return this.view=t.winners,void this.renderPage(this.pageWinners);this.view=t.garage,this.pageWinners.removeWinners(),this.renderPage(this.pageGarage)}goToTheNextPage(){this.view!==t.garage?this.pageWinners.mainWinners.goToNextPage():this.pageGarage.mainGarage.goToTheNextPage()}goToThePreviousPage(){this.view!==t.garage?this.pageWinners.mainWinners.goToPreviousPage():this.pageGarage.mainGarage.goToThePreviousPage()}};y.render(t.garage)})();